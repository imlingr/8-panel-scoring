
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>113è·æ¥­è¨ªè«‡-è‡ªè©•ï¼†äº’è©•è¡¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #ffffff; /* èƒŒæ™¯æ”¹ç‚ºç™½è‰² */
        }
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .progress-bar {
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background-color: #4f46e5;
            transition: width 0.3s ease;
        }
        .option-card {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        .option-card:hover {
            border-color: #a5b4fc;
            background-color: #f5f7ff;
        }
        .option-card.selected {
            border-color: #4f46e5;
            background-color: #eef2ff;
        }
        .option-card.evaluated {
            border-color: #10b981;
            background-color: #ecfdf5;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
            transition: all 0.2s ease;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-secondary {
            background-color: #e2e8f0;
            color: #4b5563;
            transition: all 0.2s ease;
        }
        .btn-secondary:hover {
            background-color: #cbd5e1;
        }
        .rating-container {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        .rating-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #f3f4f6;
            border: 2px solid #e5e7eb;
        }
        .rating-btn:hover {
            background-color: #e5edff;
            border-color: #a5b4fc;
        }
        .rating-btn.selected {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }
        .custom-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .custom-checkbox:hover {
            background-color: #f5f7ff;
        }
        .custom-checkbox.selected {
            background-color: #eef2ff;
        }
        .custom-checkbox input {
            margin-right: 10px;
        }
        .class-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        .class-icon {
            width: 80px;
            height: 80px;
            margin-bottom: 12px;
        }
        .header-logo {
            max-width: 100%;
            height: auto;
            margin-bottom: 20px;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #4f46e5;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body class="py-8 px-4">
    <div class="form-container p-6 md:p-8">
        <!-- è¡¨å–®é ‚éƒ¨åœ–ç‰‡ - å·²æ›´æ–° -->
        <div class="text-center mb-6">
            <img src="https://lh3.googleusercontent.com/pw/AP1GczNXDp3p02uknh_-hoyMzneujGrAXG210XUd_rkskHpWdXauH3OJ8jK_14rEwYzcG5h8u3J_X2FBTgVdhDcO4tdJe_BbDE7uFLgGeQIAN2lvsKx4lMaYjSPfSf1jR3Sam6gVROPTq9Afd10tIWMlW86l=w1920-h480-s-no-gm?authuser=0" alt="è¡¨å–®é ‚éƒ¨åœ–ç‰‡" class="header-logo mx-auto">
        </div>
        
        <h1 class="text-2xl md:text-3xl font-bold text-center mb-6 text-indigo-700">113è·æ¥­è¨ªè«‡-è‡ªè©•ï¼†äº’è©•è¡¨</h1>
        
        <div class="mb-6">
            <div class="progress-bar">
                <div class="progress" id="progressBar" style="width: 0%"></div>
            </div>
            <div class="flex justify-between mt-2 text-sm text-gray-500">
                <span>é–‹å§‹</span>
                <span>ç­ç´š/çµ„åˆ¥</span>
                <span>è‡ªè©•</span>
                <span>äº’è©•</span>
                <span>å®Œæˆ</span>
            </div>
        </div>

        <!-- è¡¨å–®å€åŸŸ -->
        <div id="formContainer">
            <!-- ç­ç´šé¸æ“‡é é¢ - å·²æ›´æ–°åœ–æ¨™å’Œå¸ƒå±€ -->
            <div id="classSelection" class="form-page">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">1</span>
                    è«‹é¸æ“‡æ‚¨çš„ç­ç´š
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="option-card class-card cursor-pointer" data-value="809" onclick="selectClass(this)">
                        <img src="https://cdn-icons-png.flaticon.com/128/13562/13562989.png" alt="809ç­" class="class-icon">
                        <span class="font-medium">809ç­</span>
                    </div>
                    <div class="option-card class-card cursor-pointer" data-value="818" onclick="selectClass(this)">
                        <img src="https://cdn-icons-png.flaticon.com/128/13562/13562979.png" alt="818ç­" class="class-icon">
                        <span class="font-medium">818ç­</span>
                    </div>
                </div>
                <div class="flex justify-end">
                    <button id="nextToGroup" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- çµ„åˆ¥é¸æ“‡é é¢ -->
            <div id="groupSelection" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">2</span>
                    è«‹é¸æ“‡æ‚¨çš„çµ„åˆ¥
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6" id="groupOptions">
                    <!-- çµ„åˆ¥é¸é …å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('classSelection')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToSelfEval" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- è‡ªè©•-é¸æ“‡è‡ªå·±é é¢ -->
            <div id="selfSelection" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">3</span>
                    è«‹é¸æ“‡æ‚¨æ˜¯å“ªä¸€ä½çµ„å“¡
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" id="memberOptions">
                    <!-- çµ„å“¡é¸é …å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('groupSelection')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToSelfTasks" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- è‡ªè©•-å·¥ä½œä»»å‹™é é¢ -->
            <div id="selfTasks" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">4</span>
                    æ‚¨åœ¨é€™æ¬¡è·æ¥­è¨ªè«‡ä¸­è² è²¬çš„å·¥ä½œä»»å‹™æ˜¯ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰
                </h2>
                <div class="mb-6" id="taskCheckboxes">
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task1" name="selfTasks" value="ç•¶å¤©åƒèˆ‡è¨ªè«‡">
                        <label for="task1">ğŸ“… ç•¶å¤©åƒèˆ‡è¨ªè«‡</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task2" name="selfTasks" value="æ¥æ´½å—è«‡è€…">
                        <label for="task2">ğŸ¤ æ¥æ´½å—è«‡è€…</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task3" name="selfTasks" value="æŸ¥è³‡æ–™">
                        <label for="task3">ğŸ” æŸ¥è³‡æ–™</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task4" name="selfTasks" value="è¨­è¨ˆå•é¡Œ">
                        <label for="task4">â“ è¨­è¨ˆå•é¡Œ</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task5" name="selfTasks" value="å°è¨˜è€…è¨ªå•">
                        <label for="task5">ğŸ¤ å°è¨˜è€…è¨ªå•</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task6" name="selfTasks" value="æ‹ç…§">
                        <label for="task6">ğŸ“¸ æ‹ç…§</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task7" name="selfTasks" value="è¨˜éŒ„">
                        <label for="task7">ğŸ“ è¨˜éŒ„</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task8" name="selfTasks" value="åšç°¡å ±">
                        <label for="task8">ğŸ’» åšç°¡å ±</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task9" name="selfTasks" value="ä¸Šå°å ±å‘Š">
                        <label for="task9">ğŸ­ ä¸Šå°å ±å‘Š</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task10" name="selfTasks" value="ç·¨åŠ‡">
                        <label for="task10">âœï¸ ç·¨åŠ‡</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task11" name="selfTasks" value="è¡¨æ¼”">
                        <label for="task11">ğŸ¬ è¡¨æ¼”</label>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">å…¶ä»–å·¥ä½œä»»å‹™ï¼ˆé¸å¡«ï¼‰</label>
                        <input type="text" id="otherSelfTask" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="è«‹è¼¸å…¥å…¶ä»–å·¥ä½œä»»å‹™">
                    </div>
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('selfSelection')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToSelfEffort" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- è‡ªè©•-æŠ•å…¥ç¨‹åº¦é é¢ -->
            <div id="selfEffort" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">5</span>
                    æ‚¨èªç‚ºè‡ªå·±çš„æŠ•å…¥èªçœŸå”åŠ©ç¨‹åº¦å¦‚ä½•ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰
                </h2>
                <div class="mb-6" id="effortCheckboxes">
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort1" name="selfEffort" value="Aæˆ‘å¹¾ä¹ä»€éº¼éƒ½æ²’æœ‰åšğŸ™ƒ">
                        <label for="effort1">Aæˆ‘å¹¾ä¹ä»€éº¼éƒ½æ²’æœ‰åšğŸ™ƒ</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort2" name="selfEffort" value="Bæˆ‘åªåšäº†è‡ªå·±çš„å·¥ä½œï¼Œè€Œä¸”é‚„æ²’åšå®ŒğŸ˜£">
                        <label for="effort2">Bæˆ‘åªåšäº†è‡ªå·±çš„å·¥ä½œï¼Œè€Œä¸”é‚„æ²’åšå®ŒğŸ˜£</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort3" name="selfEffort" value="Cæˆ‘åªå®Œæˆè‡ªå·±çš„å·¥ä½œï¼Œå¦ç™½èªªæœ‰é»éš¨ä¾¿ğŸ˜…">
                        <label for="effort3">Cæˆ‘åªå®Œæˆè‡ªå·±çš„å·¥ä½œï¼Œå¦ç™½èªªæœ‰é»éš¨ä¾¿ğŸ˜…</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort4" name="selfEffort" value="Dæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œè€Œä¸”æˆ‘é‚„é²äº¤ğŸ˜”">
                        <label for="effort4">Dæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œè€Œä¸”æˆ‘é‚„é²äº¤ğŸ˜”</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort5" name="selfEffort" value="Eæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œæˆ‘ç›¡åŠ›äº†ï¼Œä½†æˆæœå¥½åƒæ™®é€šè€Œå·²ğŸ¤”">
                        <label for="effort5">Eæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œæˆ‘ç›¡åŠ›äº†ï¼Œä½†æˆæœå¥½åƒæ™®é€šè€Œå·²ğŸ¤”</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort6" name="selfEffort" value="Fæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œä½†æˆ‘æœ‰èªçœŸåšğŸ«¡">
                        <label for="effort6">Fæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œä½†æˆ‘æœ‰èªçœŸåšğŸ«¡</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort7" name="selfEffort" value="Gæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œä½†æˆ‘èŠ±è²»äº†å¾ˆå¤šæ™‚é–“å’Œå¿ƒåŠ›ï¼Œæˆ‘å¾ˆèªçœŸğŸ™‚">
                        <label for="effort7">Gæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œä½†æˆ‘èŠ±è²»äº†å¾ˆå¤šæ™‚é–“å’Œå¿ƒåŠ›ï¼Œæˆ‘å¾ˆèªçœŸğŸ™‚</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort8" name="selfEffort" value="Hæˆ‘ä¸åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œæˆ‘é‚„æœƒé—œå¿ƒæé†’å…¶ä»–çš„çµ„å“¡é€²åº¦ğŸ˜Š">
                        <label for="effort8">Hæˆ‘ä¸åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œæˆ‘é‚„æœƒé—œå¿ƒæé†’å…¶ä»–çš„çµ„å“¡é€²åº¦ğŸ˜Š</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort9" name="selfEffort" value="I æˆ‘ä¸åªå®Œæˆè‡ªå·±çš„ä»»å‹™ï¼Œæˆ‘å¾Œä¾†é‚„å¹«å¿™å…¶ä»–äººä¸€èµ·åšï¼ŒèŠ±äº†è¶…å¤šæ™‚é–“åŠå¿ƒåŠ›ğŸ˜ƒ">
                        <label for="effort9">I æˆ‘ä¸åªå®Œæˆè‡ªå·±çš„ä»»å‹™ï¼Œæˆ‘å¾Œä¾†é‚„å¹«å¿™å…¶ä»–äººä¸€èµ·åšï¼ŒèŠ±äº†è¶…å¤šæ™‚é–“åŠå¿ƒåŠ›ğŸ˜ƒ</label>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">å…¶ä»–æŠ•å…¥ç¨‹åº¦æè¿°ï¼ˆé¸å¡«ï¼‰</label>
                        <input type="text" id="otherSelfEffort" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="è«‹è¼¸å…¥å…¶ä»–æŠ•å…¥ç¨‹åº¦æè¿°">
                    </div>
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('selfTasks')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToSelfRating" class="btn-primary px-6 py-2 rounded-lg font-medium">
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- è‡ªè©•-è©•åˆ†é é¢ -->
            <div id="selfRating" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">6</span>
                    è«‹ç‚ºè‡ªå·±çš„è¡¨ç¾è©•åˆ†ï¼ˆ1-10åˆ†ï¼‰
                </h2>
                <div class="mb-6">
                    <div class="rating-container">
                        <div class="rating-btn" data-value="1" onclick="selectRating(this, 'selfRatingValue')">1</div>
                        <div class="rating-btn" data-value="2" onclick="selectRating(this, 'selfRatingValue')">2</div>
                        <div class="rating-btn" data-value="3" onclick="selectRating(this, 'selfRatingValue')">3</div>
                        <div class="rating-btn" data-value="4" onclick="selectRating(this, 'selfRatingValue')">4</div>
                        <div class="rating-btn" data-value="5" onclick="selectRating(this, 'selfRatingValue')">5</div>
                        <div class="rating-btn" data-value="6" onclick="selectRating(this, 'selfRatingValue')">6</div>
                        <div class="rating-btn" data-value="7" onclick="selectRating(this, 'selfRatingValue')">7</div>
                        <div class="rating-btn" data-value="8" onclick="selectRating(this, 'selfRatingValue')">8</div>
                        <div class="rating-btn" data-value="9" onclick="selectRating(this, 'selfRatingValue')">9</div>
                        <div class="rating-btn" data-value="10" onclick="selectRating(this, 'selfRatingValue')">10</div>
                    </div>
                    <input type="hidden" id="selfRatingValue" value="">
                    <div class="text-center text-sm text-gray-500 mt-2">
                        <span class="float-left">è¼ƒå·®</span>
                        <span class="float-right">å„ªç§€</span>
                    </div>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">æ•´é«”ä¾†èªªï¼Œæˆ‘è¦ºå¾—åœ¨é€™æ¬¡è·æ¥­è¨ªè«‡ä¸­ï¼Œæˆ‘çš„è¡¨ç¾å¦‚ä½•ï¼Ÿæˆ‘å¯ä»¥åœ¨ä»€éº¼åœ°æ–¹æ›´é€²æ­¥ï¼Ÿ</label>
                    <textarea id="selfComment" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="4" placeholder="è«‹è¼¸å…¥æ‚¨çš„è‡ªæˆ‘è©•åƒ¹..."></textarea>
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('selfEffort')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToPeerEval" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- äº’è©•-é¸æ“‡çµ„å“¡é é¢ -->
            <div id="peerSelection" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">7</span>
                    è«‹é¸æ“‡æ‚¨è¦è©•åƒ¹çš„çµ„å“¡ (<span id="peerEvalCount">0</span>/4)
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" id="peerOptions">
                    <!-- çµ„å“¡é¸é …å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('selfRating')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToPeerTasks" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- äº’è©•-å·¥ä½œä»»å‹™é é¢ -->
            <div id="peerTasks" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">8</span>
                    å°±æ‚¨æ‰€çŸ¥ï¼Œ<span id="currentPeerName" class="text-indigo-600 font-bold"></span>å¯¦éš›ä¸Šåšäº†å“ªäº›å·¥ä½œä»»å‹™ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰
                </h2>
                <div class="mb-6" id="peerTaskCheckboxes">
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask1" name="peerTasks" value="ç•¶å¤©åƒèˆ‡è¨ªè«‡">
                        <label for="peerTask1">ğŸ“… ç•¶å¤©åƒèˆ‡è¨ªè«‡</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask2" name="peerTasks" value="æ¥æ´½å—è«‡è€…">
                        <label for="peerTask2">ğŸ¤ æ¥æ´½å—è«‡è€…</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask3" name="peerTasks" value="æŸ¥è³‡æ–™">
                        <label for="peerTask3">ğŸ” æŸ¥è³‡æ–™</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask4" name="peerTasks" value="è¨­è¨ˆå•é¡Œ">
                        <label for="peerTask4">â“ è¨­è¨ˆå•é¡Œ</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask5" name="peerTasks" value="å°è¨˜è€…è¨ªå•">
                        <label for="peerTask5">ğŸ¤ å°è¨˜è€…è¨ªå•</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask6" name="peerTasks" value="æ‹ç…§">
                        <label for="peerTask6">ğŸ“¸ æ‹ç…§</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask7" name="peerTasks" value="è¨˜éŒ„">
                        <label for="peerTask7">ğŸ“ è¨˜éŒ„</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask8" name="peerTasks" value="åšç°¡å ±">
                        <label for="peerTask8">ğŸ’» åšç°¡å ±</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask9" name="peerTasks" value="ä¸Šå°å ±å‘Š">
                        <label for="peerTask9">ğŸ­ ä¸Šå°å ±å‘Š</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask10" name="peerTasks" value="ç·¨åŠ‡">
                        <label for="peerTask10">âœï¸ ç·¨åŠ‡</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask11" name="peerTasks" value="è¡¨æ¼”">
                        <label for="peerTask11">ğŸ¬ è¡¨æ¼”</label>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">å…¶ä»–å·¥ä½œä»»å‹™ï¼ˆé¸å¡«ï¼‰</label>
                        <input type="text" id="otherPeerTask" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="è«‹è¼¸å…¥å…¶ä»–å·¥ä½œä»»å‹™">
                    </div>
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('peerSelection')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToPeerRating" class="btn-primary px-6 py-2 rounded-lg font-medium">
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- äº’è©•-è©•åˆ†é é¢ -->
            <div id="peerRating" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">9</span>
                    è«‹ç‚º <span id="currentPeerNameRating" class="text-indigo-600 font-bold"></span> çš„è¡¨ç¾è©•åˆ†ï¼ˆ1-10åˆ†ï¼‰
                </h2>
                <div class="mb-6">
                    <div class="rating-container">
                        <div class="rating-btn" data-value="1" onclick="selectRating(this, 'peerRatingValue')">1</div>
                        <div class="rating-btn" data-value="2" onclick="selectRating(this, 'peerRatingValue')">2</div>
                        <div class="rating-btn" data-value="3" onclick="selectRating(this, 'peerRatingValue')">3</div>
                        <div class="rating-btn" data-value="4" onclick="selectRating(this, 'peerRatingValue')">4</div>
                        <div class="rating-btn" data-value="5" onclick="selectRating(this, 'peerRatingValue')">5</div>
                        <div class="rating-btn" data-value="6" onclick="selectRating(this, 'peerRatingValue')">6</div>
                        <div class="rating-btn" data-value="7" onclick="selectRating(this, 'peerRatingValue')">7</div>
                        <div class="rating-btn" data-value="8" onclick="selectRating(this, 'peerRatingValue')">8</div>
                        <div class="rating-btn" data-value="9" onclick="selectRating(this, 'peerRatingValue')">9</div>
                        <div class="rating-btn" data-value="10" onclick="selectRating(this, 'peerRatingValue')">10</div>
                    </div>
                    <input type="hidden" id="peerRatingValue" value="">
                    <div class="text-center text-sm text-gray-500 mt-2">
                        <span class="float-left">è¼ƒå·®</span>
                        <span class="float-right">å„ªç§€</span>
                    </div>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">æ‚¨çµ¦ä»–/å¥¹é€™å€‹åˆ†æ•¸çš„å…·é«”ç†ç”±</label>
                    <textarea id="peerComment" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="4" placeholder="è«‹è¼¸å…¥æ‚¨çš„è©•åƒ¹ç†ç”±..."></textarea>
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('peerTasks')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextPeerEval" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- ç¢ºèªé é¢ -->
            <div id="confirmation" class="form-page hidden">
                <div class="bg-green-50 border-l-4 border-green-400 p-4 mb-6">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-green-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-green-700">
                                æ‚¨å·²å®Œæˆæ‰€æœ‰è©•åƒ¹ï¼æ„Ÿè¬æ‚¨çš„åƒèˆ‡ã€‚
                            </p>
                        </div>
                    </div>
                </div>

                <h2 class="text-xl font-semibold mb-4">è©•åƒ¹æ‘˜è¦</h2>
                
                <div class="mb-6">
                    <h3 class="font-medium text-gray-700 mb-2">åŸºæœ¬è³‡æ–™</h3>
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <p><span class="font-medium">ç­ç´šï¼š</span><span id="summaryClass"></span></p>
                        <p class="mt-1"><span class="font-medium">çµ„åˆ¥ï¼š</span><span id="summaryGroup"></span></p>
                        <p class="mt-1"><span class="font-medium">å§“åï¼š</span><span id="summarySelf"></span></p>
                    </div>
                    
                    <h3 class="font-medium text-gray-700 mb-2">è‡ªè©•</h3>
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <p><span class="font-medium">å·¥ä½œä»»å‹™ï¼š</span><span id="summarySelfTasks"></span></p>
                        <p class="mt-1"><span class="font-medium">å…¶ä»–å·¥ä½œä»»å‹™ï¼š</span><span id="summaryOtherSelfTask"></span></p>
                        <p class="mt-1"><span class="font-medium">æŠ•å…¥ç¨‹åº¦ï¼š</span><span id="summarySelfEffort"></span></p>
                        <p class="mt-1"><span class="font-medium">å…¶ä»–æŠ•å…¥ç¨‹åº¦æè¿°ï¼š</span><span id="summaryOtherSelfEffort"></span></p>
                        <p class="mt-1"><span class="font-medium">è‡ªè©•åˆ†æ•¸ï¼š</span><span id="summarySelfRating"></span></p>
                        <p class="mt-1"><span class="font-medium">è‡ªæˆ‘è©•åƒ¹ï¼š</span></p>
                        <p id="summarySelfComment" class="text-gray-600 mt-1"></p>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="font-medium text-gray-700 mb-2">äº’è©•</h3>
                    <div id="peerEvalSummary" class="space-y-4">
                        <!-- äº’è©•æ‘˜è¦å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>

                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="returnToStart()">
                        è¿”å›ä¿®æ­£
                    </button>
                    <button id="submitForm" class="btn-primary px-6 py-2 rounded-lg font-medium">
                        æäº¤è©•åƒ¹
                    </button>
                </div>
            </div>

            <!-- æäº¤æˆåŠŸé é¢ -->
            <div id="success" class="form-page hidden">
                <div class="text-center py-10">
                    <svg class="mx-auto h-20 w-20 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h2 class="mt-4 text-2xl font-bold text-gray-900">æäº¤æˆåŠŸï¼</h2>
                    <p class="mt-2 text-gray-600">æ„Ÿè¬æ‚¨å®Œæˆè‡ªè©•èˆ‡äº’è©•è¡¨å–®ã€‚</p>
                    <button id="takeScreenshot" class="mt-6 btn-primary px-6 py-2 rounded-lg font-medium">
                        å…¨é æˆªåœ–å‚³çµ¦è€å¸«
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- è¼‰å…¥ä¸­é®ç½© -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p class="text-gray-700 font-medium">æäº¤ä¸­ï¼Œè«‹ç¨å€™...</p>
    </div>

    <script>
        // ç­ç´šå’Œçµ„åˆ¥è³‡æ–™
        const classGroups = {
            '809': [
                {
                    group: 'ç¬¬1çµ„',
                    members: ['04æ—è—¤è«º', '12è¬ç§‰ç¹', '15é‚±é›…æ¶µ', '21é™³å† ç‘œ', '24é»ƒæ˜Ÿç‘œ']
                },
                {
                    group: 'ç¬¬2çµ„',
                    members: ['03æ—é§¿æˆ', '09é»ƒçº', '17å¼µéƒå©', '22ç«¥äºèŠ³', '25é»ƒæ¸ç”„']
                },
                {
                    group: 'ç¬¬3çµ„',
                    members: ['01ç‹æ³‰è±¡', '12è¬ç§‰ç¹', '08æ›¾å”¯ç¥', '14æ—èŠŠæ¨‚', '19å¼µå­¸æš„']
                },
                {
                    group: 'ç¬¬4çµ„',
                    members: ['06å¼µæ©ç‘', '10åŠ‰ä¿®é½Š', '16æ´ªèˆ’èŠ¸', '20é™³æ˜€å½¤', '23é»ƒé‡‡æ½”']
                },
                {
                    group: 'ç¬¬5çµ„',
                    members: ['02ææ˜Šå¡', '07æ›¹ç…œæ‰¿', '11åŠ‰ç§©ç¶¸', '18å¼µå®¸èª', '26è¬æ—»çŠ']
                }
            ],
            '818': [
                {
                    group: 'ç¬¬1çµ„',
                    members: ['08é™³å¥•å´´', '11è”¡èƒ½ç­Œ', '12è•­å®‰ç¥', '21åŠ‰äºˆè¬™', '27å‘æ–‡æ–‡']
                },
                {
                    group: 'ç¬¬2çµ„',
                    members: ['02æå’Œæ¨‚', '03æå“²å»·', '09æ­ç¥ç¶¸', '17æ—å¯æƒŸ', '26ç¾…åŸ¹èŠ¯']
                },
                {
                    group: 'ç¬¬3çµ„',
                    members: ['04æ—å“ä½‘', '11è”¡èƒ½ç­Œ', '22è”¡ç’¦å¿»', '23è•­å®‰å¦', '25è—å¿ƒè¨€']
                },
                {
                    group: 'ç¬¬4çµ„',
                    members: ['06æ´ªæ™¨è€€', '13è–›ç‰§å®¸', '14é¾ä»•æ°', '15ç‹å©§èŠ¸', '18å­«è‰è‘‰']
                },
                {
                    group: 'ç¬¬5çµ„',
                    members: ['01ç‹å®¶è–°', '07å¼µå˜‰å®', '16æä¹‹ç€ ', '20é™³å­å§¸', '24è•­å®‰å¦®']
                }
            ]
        };

        // è¡¨å–®è³‡æ–™å„²å­˜
        let formData = {
            class: '',
            group: '',
            self: '',
            selfTasks: [],
            otherSelfTask: '',
            selfEffort: [],
            otherSelfEffort: '',
            selfRating: '',
            selfComment: '',
            peerEvals: [],
            timestamp: ''
        };

        // ç•¶å‰äº’è©•çš„çµ„å“¡ç´¢å¼•
        let currentPeerIndex = 0;
        let evaluatedPeers = [];
        let formSubmitted = false;

        // é é¢åˆ‡æ›å‡½æ•¸
        function showPage(pageId) {
            document.querySelectorAll('.form-page').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');
            updateProgressBar(pageId);
        }

        function prevPage(pageId) {
            showPage(pageId);
        }

        function updateProgressBar(pageId) {
            const progressMap = {
                'classSelection': 0,
                'groupSelection': 25,
                'selfSelection': 25,
                'selfTasks': 50,
                'selfEffort': 50,
                'selfRating': 50,
                'peerSelection': 75,
                'peerTasks': 75,
                'peerRating': 75,
                'confirmation': 100,
                'success': 100
            };
            
            document.getElementById('progressBar').style.width = `${progressMap[pageId]}%`;
        }

        // ç­ç´šé¸æ“‡
        function selectClass(element) {
            document.querySelectorAll('#classSelection .option-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            formData.class = element.dataset.value;
            document.getElementById('nextToGroup').disabled = false;
            
            // ç”Ÿæˆçµ„åˆ¥é¸é …
            const groupOptions = document.getElementById('groupOptions');
            groupOptions.innerHTML = '';
            
            classGroups[formData.class].forEach((groupData, index) => {
                const groupCard = document.createElement('div');
                groupCard.className = 'option-card p-4 cursor-pointer';
                groupCard.dataset.value = groupData.group;
                groupCard.onclick = function() { selectGroup(this); };
                groupCard.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-indigo-600 text-2xl mr-3">ğŸ‘¥</span>
                        <span class="font-medium">${groupData.group}</span>
                    </div>
                `;
                groupOptions.appendChild(groupCard);
            });
        }

        // çµ„åˆ¥é¸æ“‡
        function selectGroup(element) {
            document.querySelectorAll('#groupSelection .option-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            formData.group = element.dataset.value;
            document.getElementById('nextToSelfEval').disabled = false;
            
            // ç”Ÿæˆçµ„å“¡é¸é …
            const memberOptions = document.getElementById('memberOptions');
            memberOptions.innerHTML = '';
            
            const groupIndex = classGroups[formData.class].findIndex(g => g.group === formData.group);
            const members = classGroups[formData.class][groupIndex].members;
            
            members.forEach(member => {
                const memberCard = document.createElement('div');
                memberCard.className = 'option-card p-4 cursor-pointer';
                memberCard.dataset.value = member;
                memberCard.onclick = function() { selectSelf(this); };
                memberCard.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-indigo-600 text-2xl mr-3">ğŸ‘¤</span>
                        <span class="font-medium">${member}</span>
                    </div>
                `;
                memberOptions.appendChild(memberCard);
            });
        }

        // é¸æ“‡è‡ªå·±
        function selectSelf(element) {
            document.querySelectorAll('#selfSelection .option-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            formData.self = element.dataset.value;
            document.getElementById('nextToSelfTasks').disabled = false;
        }

        // åˆ‡æ›è¤‡é¸æ¡†
        function toggleCheckbox(element) {
            const checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            element.classList.toggle('selected', checkbox.checked);
            
            // æ›´æ–°ä¸‹ä¸€æ­¥æŒ‰éˆ•ç‹€æ…‹
            if (element.closest('#selfTasks')) {
                const checkedTasks = document.querySelectorAll('#selfTasks input[type="checkbox"]:checked');
                formData.selfTasks = Array.from(checkedTasks).map(cb => cb.value);
            } else if (element.closest('#selfEffort')) {
                const checkedEfforts = document.querySelectorAll('#selfEffort input[type="checkbox"]:checked');
                formData.selfEffort = Array.from(checkedEfforts).map(cb => cb.value);
            } else if (element.closest('#peerTasks')) {
                const checkedPeerTasks = document.querySelectorAll('#peerTasks input[type="checkbox"]:checked');
                const currentPeerEval = formData.peerEvals[currentPeerIndex] || {};
                currentPeerEval.tasks = Array.from(checkedPeerTasks).map(cb => cb.value);
                if (!formData.peerEvals[currentPeerIndex]) {
                    formData.peerEvals[currentPeerIndex] = currentPeerEval;
                }
            }
        }

        // é¸æ“‡è©•åˆ†
        function selectRating(element, inputId) {
            const container = element.closest('.rating-container');
            container.querySelectorAll('.rating-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            element.classList.add('selected');
            document.getElementById(inputId).value = element.dataset.value;
            
            if (inputId === 'selfRatingValue') {
                formData.selfRating = element.dataset.value;
                checkSelfRatingComplete();
            } else if (inputId === 'peerRatingValue') {
                const currentPeerEval = formData.peerEvals[currentPeerIndex] || {};
                currentPeerEval.rating = element.dataset.value;
                if (!formData.peerEvals[currentPeerIndex]) {
                    formData.peerEvals[currentPeerIndex] = currentPeerEval;
                }
                checkPeerRatingComplete();
            }
        }

        // æª¢æŸ¥è‡ªè©•è©•åˆ†æ˜¯å¦å®Œæˆ
        function checkSelfRatingComplete() {
            const selfComment = document.getElementById('selfComment').value.trim();
            formData.selfComment = selfComment;
            document.getElementById('nextToPeerEval').disabled = !(formData.selfRating && selfComment);
        }

        // æª¢æŸ¥äº’è©•è©•åˆ†æ˜¯å¦å®Œæˆ
        function checkPeerRatingComplete() {
            const peerComment = document.getElementById('peerComment').value.trim();
            const currentPeerEval = formData.peerEvals[currentPeerIndex] || {};
            currentPeerEval.comment = peerComment;
            if (!formData.peerEvals[currentPeerIndex]) {
                formData.peerEvals[currentPeerIndex] = currentPeerEval;
            }
            document.getElementById('nextPeerEval').disabled = !(currentPeerEval.rating && peerComment);
        }

        // é¸æ“‡äº’è©•çµ„å“¡
        function selectPeer(element) {
            document.querySelectorAll('#peerSelection .option-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            
            const peerName = element.dataset.value;
            const peerIndex = evaluatedPeers.findIndex(p => p.name === peerName);
            
            if (peerIndex === -1) {
                // æ–°çš„äº’è©•
                const newPeer = { name: peerName };
                evaluatedPeers.push(newPeer);
                currentPeerIndex = evaluatedPeers.length - 1;
                
                if (!formData.peerEvals[currentPeerIndex]) {
                    formData.peerEvals[currentPeerIndex] = { peer: peerName };
                } else {
                    formData.peerEvals[currentPeerIndex].peer = peerName;
                }
            } else {
                // å·²è©•éçš„çµ„å“¡
                currentPeerIndex = peerIndex;
            }
            
            document.getElementById('nextToPeerTasks').disabled = false;
            document.getElementById('currentPeerName').textContent = peerName;
            document.getElementById('currentPeerNameRating').textContent = peerName;
            
            // é‡ç½®äº’è©•è¡¨å–®
            resetPeerEvalForm();
            
            // å¦‚æœæ˜¯å·²è©•éçš„çµ„å“¡ï¼Œå¡«å…¥å·²æœ‰è³‡æ–™
            if (formData.peerEvals[currentPeerIndex]) {
                const peerEval = formData.peerEvals[currentPeerIndex];
                
                // å¡«å…¥å·¥ä½œä»»å‹™
                if (peerEval.tasks && peerEval.tasks.length > 0) {
                    document.querySelectorAll('#peerTasks input[type="checkbox"]').forEach(cb => {
                        cb.checked = peerEval.tasks.includes(cb.value);
                        cb.closest('.custom-checkbox').classList.toggle('selected', cb.checked);
                    });
                }
                
                // å¡«å…¥å…¶ä»–å·¥ä½œä»»å‹™
                if (peerEval.otherTask) {
                    document.getElementById('otherPeerTask').value = peerEval.otherTask;
                }
                
                // å¡«å…¥è©•åˆ†
                if (peerEval.rating) {
                    document.querySelectorAll('#peerRating .rating-btn').forEach(btn => {
                        if (btn.dataset.value === peerEval.rating) {
                            btn.classList.add('selected');
                        }
                    });
                    document.getElementById('peerRatingValue').value = peerEval.rating;
                }
                
                // å¡«å…¥è©•åƒ¹ç†ç”±
                if (peerEval.comment) {
                    document.getElementById('peerComment').value = peerEval.comment;
                }
            }
        }

        // é‡ç½®äº’è©•è¡¨å–®
        function resetPeerEvalForm() {
            // é‡ç½®å·¥ä½œä»»å‹™
            document.querySelectorAll('#peerTasks input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
                cb.closest('.custom-checkbox').classList.remove('selected');
            });
            document.getElementById('otherPeerTask').value = '';
            
            // é‡ç½®è©•åˆ†
            document.querySelectorAll('#peerRating .rating-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.getElementById('peerRatingValue').value = '';
            
            // é‡ç½®è©•åƒ¹ç†ç”±
            document.getElementById('peerComment').value = '';
            
            // é‡ç½®ä¸‹ä¸€æ­¥æŒ‰éˆ•
            document.getElementById('nextPeerEval').disabled = true;
        }

        // æ›´æ–°äº’è©•è¨ˆæ•¸
        function updatePeerEvalCount() {
            const count = evaluatedPeers.length;
            document.getElementById('peerEvalCount').textContent = count;
            
            // å¦‚æœå·²è©•4ä½çµ„å“¡ï¼Œè‡ªå‹•é€²å…¥ç¢ºèªé é¢
            if (count >= 4) {
                prepareSummary();
                showPage('confirmation');
            } else {
                // æ›´æ–°äº’è©•çµ„å“¡é¸é …
                updatePeerOptions();
                showPage('peerSelection');
            }
        }

        // æ›´æ–°äº’è©•çµ„å“¡é¸é …
        function updatePeerOptions() {
            const peerOptions = document.getElementById('peerOptions');
            peerOptions.innerHTML = '';
            
            const groupIndex = classGroups[formData.class].findIndex(g => g.group === formData.group);
            const members = classGroups[formData.class][groupIndex].members;
            
            members.forEach(member => {
                if (member !== formData.self) {  // æ’é™¤è‡ªå·±
                    const isEvaluated = evaluatedPeers.some(p => p.name === member);
                    const memberCard = document.createElement('div');
                    memberCard.className = `option-card p-4 cursor-pointer ${isEvaluated ? 'evaluated' : ''}`;
                    memberCard.dataset.value = member;
                    memberCard.onclick = function() { selectPeer(this); };
                    
                    let statusText = '';
                    if (isEvaluated) {
                        statusText = '<span class="text-green-500 text-sm ml-2">ï¼ˆå·²è©•åˆ†ï¼‰</span>';
                    }
                    
                    memberCard.innerHTML = `
                        <div class="flex items-center">
                            <span class="text-indigo-600 text-2xl mr-3">ğŸ‘¤</span>
                            <span class="font-medium">${member}${statusText}</span>
                        </div>
                    `;
                    peerOptions.appendChild(memberCard);
                }
            });
        }

        // æº–å‚™æ‘˜è¦é é¢
        function prepareSummary() {
            // åŸºæœ¬è³‡æ–™
            document.getElementById('summaryClass').textContent = formData.class + 'ç­';
            document.getElementById('summaryGroup').textContent = formData.group;
            document.getElementById('summarySelf').textContent = formData.self;
            
            // è‡ªè©•æ‘˜è¦
            document.getElementById('summarySelfTasks').textContent = formData.selfTasks.join(', ') || 'ç„¡';
            document.getElementById('summaryOtherSelfTask').textContent = formData.otherSelfTask || 'ç„¡';
            document.getElementById('summarySelfEffort').textContent = formData.selfEffort.join(', ') || 'ç„¡';
            document.getElementById('summaryOtherSelfEffort').textContent = formData.otherSelfEffort || 'ç„¡';
            document.getElementById('summarySelfRating').textContent = formData.selfRating;
            document.getElementById('summarySelfComment').textContent = formData.selfComment;
            
            // äº’è©•æ‘˜è¦
            const peerEvalSummary = document.getElementById('peerEvalSummary');
            peerEvalSummary.innerHTML = '';
            
            formData.peerEvals.forEach((peerEval, index) => {
                const peerSummary = document.createElement('div');
                peerSummary.className = 'bg-gray-50 p-4 rounded-lg mb-4';
                peerSummary.innerHTML = `
                    <h4 class="font-medium text-indigo-600 mb-2">äº’è©• ${index + 1}: ${peerEval.peer}</h4>
                    <p><span class="font-medium">å·¥ä½œä»»å‹™ï¼š</span>${peerEval.tasks ? peerEval.tasks.join(', ') : 'ç„¡'}</p>
                    <p class="mt-1"><span class="font-medium">å…¶ä»–å·¥ä½œä»»å‹™ï¼š</span>${peerEval.otherTask || 'ç„¡'}</p>
                    <p class="mt-1"><span class="font-medium">è©•åˆ†ï¼š</span>${peerEval.rating}</p>
                    <p class="mt-1"><span class="font-medium">è©•åƒ¹ç†ç”±ï¼š</span></p>
                    <p class="text-gray-600 mt-1">${peerEval.comment}</p>
                `;
                peerEvalSummary.appendChild(peerSummary);
            });
        }

        // è¿”å›é–‹å§‹é é¢
        function returnToStart() {
            showPage('classSelection');
        }

        // æäº¤è¡¨å–®åˆ°Googleè©¦ç®—è¡¨
        async function submitToGoogleSheet() {
            // é¡¯ç¤ºè¼‰å…¥ä¸­é®ç½©
            document.getElementById('loadingOverlay').classList.remove('hidden');
            
            // æ·»åŠ æ™‚é–“æˆ³
            formData.timestamp = new Date().toISOString();
            
            try {
                // å°‡è¡¨å–®è³‡æ–™è½‰æ›ç‚ºé©åˆæäº¤çš„æ ¼å¼
                const formattedData = formatDataForSubmission(formData);
                
                // ä½¿ç”¨æ›´æ–°å¾Œçš„Google Apps Script Web App URL
                const scriptURL = 'https://script.google.com/macros/s/AKfycbxyuNBOgCLjiIRz6Z-CYxHKOa1GUlqnlmVCZC16ULuoB2xQ7c7FBxhm1nTmmdxJapqpRA/exec';
                
                const response = await fetch(scriptURL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formattedData),
                });
                
                if (response.ok) {
                    // éš±è—è¼‰å…¥ä¸­é®ç½©
                    document.getElementById('loadingOverlay').classList.add('hidden');
                    formSubmitted = true;
                    showPage('success');
                } else {
                    throw new Error('æäº¤å¤±æ•—');
                }
            } catch (error) {
                console.error('æäº¤éŒ¯èª¤:', error);
                // éš±è—è¼‰å…¥ä¸­é®ç½©
                document.getElementById('loadingOverlay').classList.add('hidden');
                alert('æäº¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
            }
        }

        // æ ¼å¼åŒ–è³‡æ–™ä»¥ä¾¿æäº¤
        function formatDataForSubmission(data) {
            // åŸºæœ¬è³‡æ–™
            const baseData = {
                timestamp: data.timestamp,
                class: data.class,
                group: data.group,
                self: data.self,
                selfTasks: data.selfTasks.join(', '),
                otherSelfTask: data.otherSelfTask,
                selfEffort: data.selfEffort.join(', '),
                otherSelfEffort: data.otherSelfEffort,
                selfRating: data.selfRating,
                selfComment: data.selfComment
            };
            
            // äº’è©•è³‡æ–™
            data.peerEvals.forEach((peerEval, index) => {
                baseData[`peer${index+1}`] = peerEval.peer;
                baseData[`peer${index+1}Tasks`] = peerEval.tasks ? peerEval.tasks.join(', ') : '';
                baseData[`peer${index+1}OtherTask`] = peerEval.otherTask || '';
                baseData[`peer${index+1}Rating`] = peerEval.rating;
                baseData[`peer${index+1}Comment`] = peerEval.comment;
            });
            
            return baseData;
        }

        // æˆªåœ–åŠŸèƒ½
        async function takeScreenshot() {
            // é¡¯ç¤ºè¼‰å…¥ä¸­é®ç½©
            document.getElementById('loadingOverlay').classList.remove('hidden');
            document.getElementById('loadingOverlay').querySelector('p').textContent = 'æ­£åœ¨ç”Ÿæˆæˆªåœ–ï¼Œè«‹ç¨å€™...';
            
            try {
                // è¿”å›åˆ°æ‘˜è¦é é¢ä»¥ä¾¿æˆªåœ–
                showPage('confirmation');
                
                // ç­‰å¾…DOMæ›´æ–°
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // ä½¿ç”¨html2canvasæˆªå–æ•´å€‹é é¢
                const canvas = await html2canvas(document.querySelector('.form-container'));
                
                // å°‡canvasè½‰æ›ç‚ºåœ–ç‰‡
                const image = canvas.toDataURL('image/png');
                
                // å‰µå»ºä¸‹è¼‰é€£çµ
                const link = document.createElement('a');
                link.href = image;
                link.download = `${formData.class}ç­_${formData.group}_${formData.self}_è‡ªè©•äº’è©•è¡¨.png`;
                
                // æ¨¡æ“¬é»æ“Šä¸‹è¼‰
                link.click();
                
                // éš±è—è¼‰å…¥ä¸­é®ç½©
                document.getElementById('loadingOverlay').classList.add('hidden');
                
                // æ‰“é–‹pCloudä¸Šå‚³é é¢
                window.open('https://u.pcloud.com/#page=puplink&code=zTLXZRj08u0M2eDFIbRKrAJjmd8hwOzvy', '_blank');
                
            } catch (error) {
                console.error('æˆªåœ–éŒ¯èª¤:', error);
                document.getElementById('loadingOverlay').classList.add('hidden');
                alert('æˆªåœ–ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
            }
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç­ç´šé¸æ“‡ä¸‹ä¸€æ­¥
            document.getElementById('nextToGroup').addEventListener('click', function() {
                showPage('groupSelection');
            });
            
            // çµ„åˆ¥é¸æ“‡ä¸‹ä¸€æ­¥
            document.getElementById('nextToSelfEval').addEventListener('click', function() {
                showPage('selfSelection');
            });
            
            // è‡ªå·±é¸æ“‡ä¸‹ä¸€æ­¥
            document.getElementById('nextToSelfTasks').addEventListener('click', function() {
                showPage('selfTasks');
            });
            
            // è‡ªè©•å·¥ä½œä»»å‹™ä¸‹ä¸€æ­¥
            document.getElementById('nextToSelfEffort').addEventListener('click', function() {
                formData.otherSelfTask = document.getElementById('otherSelfTask').value;
                showPage('selfEffort');
            });
            
            // è‡ªè©•æŠ•å…¥ç¨‹åº¦ä¸‹ä¸€æ­¥
            document.getElementById('nextToSelfRating').addEventListener('click', function() {
                formData.otherSelfEffort = document.getElementById('otherSelfEffort').value;
                showPage('selfRating');
            });
            
            // è‡ªè©•è©•åˆ†ä¸‹ä¸€æ­¥
            document.getElementById('nextToPeerEval').addEventListener('click', function() {
                // åˆå§‹åŒ–äº’è©•çµ„å“¡é¸é …
                updatePeerOptions();
                showPage('peerSelection');
            });
            
            // ç›£è½è‡ªè©•è©•åˆ†æ–‡å­—è¼¸å…¥
            document.getElementById('selfComment').addEventListener('input', checkSelfRatingComplete);
            
            // äº’è©•çµ„å“¡é¸æ“‡ä¸‹ä¸€æ­¥
            document.getElementById('nextToPeerTasks').addEventListener('click', function() {
                showPage('peerTasks');
            });
            
            // äº’è©•å·¥ä½œä»»å‹™ä¸‹ä¸€æ­¥
            document.getElementById('nextToPeerRating').addEventListener('click', function() {
                const currentPeerEval = formData.peerEvals[currentPeerIndex] || {};
                currentPeerEval.otherTask = document.getElementById('otherPeerTask').value;
                if (!formData.peerEvals[currentPeerIndex]) {
                    formData.peerEvals[currentPeerIndex] = currentPeerEval;
                }
                showPage('peerRating');
            });
            
            // ç›£è½äº’è©•è©•åˆ†æ–‡å­—è¼¸å…¥
            document.getElementById('peerComment').addEventListener('input', checkPeerRatingComplete);
            
            // äº’è©•è©•åˆ†ä¸‹ä¸€æ­¥
            document.getElementById('nextPeerEval').addEventListener('click', function() {
                updatePeerEvalCount();
            });
            
            // æäº¤è¡¨å–®
            document.getElementById('submitForm').addEventListener('click', function() {
                submitToGoogleSheet();
            });
            
            // æˆªåœ–æŒ‰éˆ•
            document.getElementById('takeScreenshot').addEventListener('click', function() {
                takeScreenshot();
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'945c03d7d3d24a67',t:'MTc0ODI0OTMyMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>