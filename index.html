
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>113è·æ¥­è¨ªè«‡-è‡ªè©•ï¼†äº’è©•è¡¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #ffffff; /* èƒŒæ™¯æ”¹ç‚ºç™½è‰² */
        }
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .progress-bar {
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background-color: #4f46e5;
            transition: width 0.3s ease;
        }
        .option-card {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        .option-card:hover {
            border-color: #a5b4fc;
            background-color: #f5f7ff;
        }
        .option-card.selected {
            border-color: #4f46e5;
            background-color: #eef2ff;
        }
        .option-card.evaluated {
            border-color: #10b981;
            background-color: #ecfdf5;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
            transition: all 0.2s ease;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-secondary {
            background-color: #e2e8f0;
            color: #4b5563;
            transition: all 0.2s ease;
        }
        .btn-secondary:hover {
            background-color: #cbd5e1;
        }
        .rating-container {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        .rating-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #f3f4f6;
            border: 2px solid #e5e7eb;
        }
        .rating-btn:hover {
            background-color: #e5edff;
            border-color: #a5b4fc;
        }
        .rating-btn.selected {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }
        .custom-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .custom-checkbox:hover {
            background-color: #f5f7ff;
        }
        .custom-checkbox.selected {
            background-color: #eef2ff;
        }
        .custom-checkbox input {
            margin-right: 10px;
        }
        .class-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        .class-icon {
            width: 80px;
            height: 80px;
            margin-bottom: 12px;
        }
        .header-logo {
            max-width: 100%;
            height: auto;
            margin-bottom: 20px;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #4f46e5;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="py-8 px-4">
    <div class="form-container p-6 md:p-8">
        <!-- è¡¨å–®é ‚éƒ¨åœ–ç‰‡ - å·²æ›´æ–° -->
        <div class="text-center mb-6">
            <img src="https://lh3.googleusercontent.com/pw/AP1GczNXDp3p02uknh_-hoyMzneujGrAXG210XUd_rkskHpWdXauH3OJ8jK_14rEwYzcG5h8u3J_X2FBTgVdhDcO4tdJe_BbDE7uFLgGeQIAN2lvsKx4lMaYjSPfSf1jR3Sam6gVROPTq9Afd10tIWMlW86l=w1920-h480-s-no-gm?authuser=0" alt="è¡¨å–®é ‚éƒ¨åœ–ç‰‡" class="header-logo mx-auto">
        </div>
        
        <h1 class="text-2xl md:text-3xl font-bold text-center mb-6 text-indigo-700">113è·æ¥­è¨ªè«‡-è‡ªè©•ï¼†äº’è©•è¡¨</h1>
        
        <div class="mb-6">
            <div class="progress-bar">
                <div class="progress" id="progressBar" style="width: 0%"></div>
            </div>
            <div class="flex justify-between mt-2 text-sm text-gray-500">
                <span>é–‹å§‹</span>
                <span>ç­ç´š/çµ„åˆ¥</span>
                <span>è‡ªè©•</span>
                <span>äº’è©•</span>
                <span>å®Œæˆ</span>
            </div>
        </div>

        <!-- è¡¨å–®å€åŸŸ -->
        <div id="formContainer">
            <!-- ç­ç´šé¸æ“‡é é¢ - å·²æ›´æ–°åœ–æ¨™å’Œå¸ƒå±€ -->
            <div id="classSelection" class="form-page">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">1</span>
                    è«‹é¸æ“‡æ‚¨çš„ç­ç´š
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="option-card class-card cursor-pointer" data-value="809" onclick="selectClass(this)">
                        <img src="https://cdn-icons-png.flaticon.com/128/13562/13562989.png" alt="809ç­" class="class-icon">
                        <span class="font-medium">809ç­</span>
                    </div>
                    <div class="option-card class-card cursor-pointer" data-value="818" onclick="selectClass(this)">
                        <img src="https://cdn-icons-png.flaticon.com/128/13562/13562979.png" alt="818ç­" class="class-icon">
                        <span class="font-medium">818ç­</span>
                    </div>
                </div>
                <div class="flex justify-end">
                    <button id="nextToGroup" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- çµ„åˆ¥é¸æ“‡é é¢ -->
            <div id="groupSelection" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">2</span>
                    è«‹é¸æ“‡æ‚¨çš„çµ„åˆ¥
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6" id="groupOptions">
                    <!-- çµ„åˆ¥é¸é …å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('classSelection')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToSelfEval" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- è‡ªè©•-é¸æ“‡è‡ªå·±é é¢ -->
            <div id="selfSelection" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">3</span>
                    è«‹é¸æ“‡æ‚¨æ˜¯å“ªä¸€ä½çµ„å“¡
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" id="memberOptions">
                    <!-- çµ„å“¡é¸é …å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('groupSelection')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToSelfTasks" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- è‡ªè©•-å·¥ä½œä»»å‹™é é¢ -->
            <div id="selfTasks" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">4</span>
                    æ‚¨åœ¨é€™æ¬¡è·æ¥­è¨ªè«‡ä¸­è² è²¬çš„å·¥ä½œä»»å‹™æ˜¯ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰
                </h2>
                <div class="mb-6" id="taskCheckboxes">
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task1" name="selfTasks" value="ç•¶å¤©åƒèˆ‡è¨ªè«‡">
                        <label for="task1">ğŸ“… ç•¶å¤©åƒèˆ‡è¨ªè«‡</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task2" name="selfTasks" value="æ¥æ´½å—è«‡è€…">
                        <label for="task2">ğŸ¤ æ¥æ´½å—è«‡è€…</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task3" name="selfTasks" value="æŸ¥è³‡æ–™">
                        <label for="task3">ğŸ” æŸ¥è³‡æ–™</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task4" name="selfTasks" value="è¨­è¨ˆå•é¡Œ">
                        <label for="task4">â“ è¨­è¨ˆå•é¡Œ</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task5" name="selfTasks" value="å°è¨˜è€…è¨ªå•">
                        <label for="task5">ğŸ¤ å°è¨˜è€…è¨ªå•</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task6" name="selfTasks" value="æ‹ç…§">
                        <label for="task6">ğŸ“¸ æ‹ç…§</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task7" name="selfTasks" value="è¨˜éŒ„">
                        <label for="task7">ğŸ“ è¨˜éŒ„</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task8" name="selfTasks" value="åšç°¡å ±">
                        <label for="task8">ğŸ’» åšç°¡å ±</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task9" name="selfTasks" value="ä¸Šå°å ±å‘Š">
                        <label for="task9">ğŸ­ ä¸Šå°å ±å‘Š</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task10" name="selfTasks" value="ç·¨åŠ‡">
                        <label for="task10">âœï¸ ç·¨åŠ‡</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="task11" name="selfTasks" value="è¡¨æ¼”">
                        <label for="task11">ğŸ¬ è¡¨æ¼”</label>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">å…¶ä»–å·¥ä½œä»»å‹™ï¼ˆé¸å¡«ï¼‰</label>
                        <input type="text" id="otherSelfTask" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="è«‹è¼¸å…¥å…¶ä»–å·¥ä½œä»»å‹™">
                    </div>
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('selfSelection')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToSelfEffort" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- è‡ªè©•-æŠ•å…¥ç¨‹åº¦é é¢ -->
            <div id="selfEffort" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">5</span>
                    æ‚¨èªç‚ºè‡ªå·±çš„æŠ•å…¥èªçœŸå”åŠ©ç¨‹åº¦å¦‚ä½•ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰
                </h2>
                <div class="mb-6" id="effortCheckboxes">
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort1" name="selfEffort" value="Aæˆ‘å¹¾ä¹ä»€éº¼éƒ½æ²’æœ‰åšğŸ™ƒ">
                        <label for="effort1">Aæˆ‘å¹¾ä¹ä»€éº¼éƒ½æ²’æœ‰åšğŸ™ƒ</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort2" name="selfEffort" value="Bæˆ‘åªåšäº†è‡ªå·±çš„å·¥ä½œï¼Œè€Œä¸”é‚„æ²’åšå®ŒğŸ˜£">
                        <label for="effort2">Bæˆ‘åªåšäº†è‡ªå·±çš„å·¥ä½œï¼Œè€Œä¸”é‚„æ²’åšå®ŒğŸ˜£</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort3" name="selfEffort" value="Cæˆ‘åªå®Œæˆè‡ªå·±çš„å·¥ä½œï¼Œå¦ç™½èªªæœ‰é»éš¨ä¾¿ğŸ˜…">
                        <label for="effort3">Cæˆ‘åªå®Œæˆè‡ªå·±çš„å·¥ä½œï¼Œå¦ç™½èªªæœ‰é»éš¨ä¾¿ğŸ˜…</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort4" name="selfEffort" value="Dæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œè€Œä¸”æˆ‘é‚„é²äº¤ğŸ˜”">
                        <label for="effort4">Dæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œè€Œä¸”æˆ‘é‚„é²äº¤ğŸ˜”</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort5" name="selfEffort" value="Eæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œæˆ‘ç›¡åŠ›äº†ï¼Œä½†æˆæœå¥½åƒæ™®é€šè€Œå·²ğŸ¤”">
                        <label for="effort5">Eæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œæˆ‘ç›¡åŠ›äº†ï¼Œä½†æˆæœå¥½åƒæ™®é€šè€Œå·²ğŸ¤”</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort6" name="selfEffort" value="Fæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œä½†æˆ‘æœ‰èªçœŸåšğŸ«¡">
                        <label for="effort6">Fæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œä½†æˆ‘æœ‰èªçœŸåšğŸ«¡</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort7" name="selfEffort" value="Gæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œä½†æˆ‘èŠ±è²»äº†å¾ˆå¤šæ™‚é–“å’Œå¿ƒåŠ›ï¼Œæˆ‘å¾ˆèªçœŸğŸ™‚">
                        <label for="effort7">Gæˆ‘åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œä½†æˆ‘èŠ±è²»äº†å¾ˆå¤šæ™‚é–“å’Œå¿ƒåŠ›ï¼Œæˆ‘å¾ˆèªçœŸğŸ™‚</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort8" name="selfEffort" value="Hæˆ‘ä¸åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œæˆ‘é‚„æœƒé—œå¿ƒæé†’å…¶ä»–çš„çµ„å“¡é€²åº¦ğŸ˜Š">
                        <label for="effort8">Hæˆ‘ä¸åªå®Œæˆäº†è‡ªå·±çš„å·¥ä½œï¼Œæˆ‘é‚„æœƒé—œå¿ƒæé†’å…¶ä»–çš„çµ„å“¡é€²åº¦ğŸ˜Š</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="effort9" name="selfEffort" value="I æˆ‘ä¸åªå®Œæˆè‡ªå·±çš„ä»»å‹™ï¼Œæˆ‘å¾Œä¾†é‚„å¹«å¿™å…¶ä»–äººä¸€èµ·åšï¼ŒèŠ±äº†è¶…å¤šæ™‚é–“åŠå¿ƒåŠ›ğŸ˜ƒ">
                        <label for="effort9">I æˆ‘ä¸åªå®Œæˆè‡ªå·±çš„ä»»å‹™ï¼Œæˆ‘å¾Œä¾†é‚„å¹«å¿™å…¶ä»–äººä¸€èµ·åšï¼ŒèŠ±äº†è¶…å¤šæ™‚é–“åŠå¿ƒåŠ›ğŸ˜ƒ</label>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">å…¶ä»–æŠ•å…¥ç¨‹åº¦æè¿°ï¼ˆé¸å¡«ï¼‰</label>
                        <input type="text" id="otherSelfEffort" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="è«‹è¼¸å…¥å…¶ä»–æŠ•å…¥ç¨‹åº¦æè¿°">
                    </div>
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('selfTasks')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToSelfRating" class="btn-primary px-6 py-2 rounded-lg font-medium">
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- è‡ªè©•-è©•åˆ†é é¢ -->
            <div id="selfRating" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">6</span>
                    è«‹ç‚ºè‡ªå·±çš„è¡¨ç¾è©•åˆ†ï¼ˆ1-10åˆ†ï¼‰
                </h2>
                <div class="mb-6">
                    <div class="rating-container">
                        <div class="rating-btn" data-value="1" onclick="selectRating(this, 'selfRatingValue')">1</div>
                        <div class="rating-btn" data-value="2" onclick="selectRating(this, 'selfRatingValue')">2</div>
                        <div class="rating-btn" data-value="3" onclick="selectRating(this, 'selfRatingValue')">3</div>
                        <div class="rating-btn" data-value="4" onclick="selectRating(this, 'selfRatingValue')">4</div>
                        <div class="rating-btn" data-value="5" onclick="selectRating(this, 'selfRatingValue')">5</div>
                        <div class="rating-btn" data-value="6" onclick="selectRating(this, 'selfRatingValue')">6</div>
                        <div class="rating-btn" data-value="7" onclick="selectRating(this, 'selfRatingValue')">7</div>
                        <div class="rating-btn" data-value="8" onclick="selectRating(this, 'selfRatingValue')">8</div>
                        <div class="rating-btn" data-value="9" onclick="selectRating(this, 'selfRatingValue')">9</div>
                        <div class="rating-btn" data-value="10" onclick="selectRating(this, 'selfRatingValue')">10</div>
                    </div>
                    <input type="hidden" id="selfRatingValue" value="">
                    <div class="text-center text-sm text-gray-500 mt-2">
                        <span class="float-left">è¼ƒå·®</span>
                        <span class="float-right">å„ªç§€</span>
                    </div>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">æ•´é«”ä¾†èªªï¼Œæˆ‘è¦ºå¾—åœ¨é€™æ¬¡è·æ¥­è¨ªè«‡ä¸­ï¼Œæˆ‘çš„è¡¨ç¾å¦‚ä½•ï¼Ÿæˆ‘å¯ä»¥åœ¨ä»€éº¼åœ°æ–¹æ›´é€²æ­¥ï¼Ÿ</label>
                    <textarea id="selfComment" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="4" placeholder="è«‹è¼¸å…¥æ‚¨çš„è‡ªæˆ‘è©•åƒ¹..."></textarea>
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('selfEffort')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToPeerEval" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- äº’è©•-é¸æ“‡çµ„å“¡é é¢ -->
            <div id="peerSelection" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">7</span>
                    è«‹é¸æ“‡æ‚¨è¦è©•åƒ¹çš„çµ„å“¡ (<span id="peerEvalCount">0</span>/4)
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" id="peerOptions">
                    <!-- çµ„å“¡é¸é …å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('selfRating')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToPeerTasks" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- äº’è©•-å·¥ä½œä»»å‹™é é¢ -->
            <div id="peerTasks" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">8</span>
                    å°±æ‚¨æ‰€çŸ¥ï¼Œ<span id="currentPeerName" class="text-indigo-600 font-bold"></span>å¯¦éš›ä¸Šåšäº†å“ªäº›å·¥ä½œä»»å‹™ï¼Ÿï¼ˆå¯è¤‡é¸ï¼‰
                </h2>
                <div class="mb-6" id="peerTaskCheckboxes">
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask1" name="peerTasks" value="ç•¶å¤©åƒèˆ‡è¨ªè«‡">
                        <label for="peerTask1">ğŸ“… ç•¶å¤©åƒèˆ‡è¨ªè«‡</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask2" name="peerTasks" value="æ¥æ´½å—è«‡è€…">
                        <label for="peerTask2">ğŸ¤ æ¥æ´½å—è«‡è€…</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask3" name="peerTasks" value="æŸ¥è³‡æ–™">
                        <label for="peerTask3">ğŸ” æŸ¥è³‡æ–™</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask4" name="peerTasks" value="è¨­è¨ˆå•é¡Œ">
                        <label for="peerTask4">â“ è¨­è¨ˆå•é¡Œ</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask5" name="peerTasks" value="å°è¨˜è€…è¨ªå•">
                        <label for="peerTask5">ğŸ¤ å°è¨˜è€…è¨ªå•</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask6" name="peerTasks" value="æ‹ç…§">
                        <label for="peerTask6">ğŸ“¸ æ‹ç…§</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask7" name="peerTasks" value="è¨˜éŒ„">
                        <label for="peerTask7">ğŸ“ è¨˜éŒ„</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask8" name="peerTasks" value="åšç°¡å ±">
                        <label for="peerTask8">ğŸ’» åšç°¡å ±</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask9" name="peerTasks" value="ä¸Šå°å ±å‘Š">
                        <label for="peerTask9">ğŸ­ ä¸Šå°å ±å‘Š</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask10" name="peerTasks" value="ç·¨åŠ‡">
                        <label for="peerTask10">âœï¸ ç·¨åŠ‡</label>
                    </div>
                    <div class="custom-checkbox" onclick="toggleCheckbox(this)">
                        <input type="checkbox" id="peerTask11" name="peerTasks" value="è¡¨æ¼”">
                        <label for="peerTask11">ğŸ¬ è¡¨æ¼”</label>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">å…¶ä»–å·¥ä½œä»»å‹™ï¼ˆé¸å¡«ï¼‰</label>
                        <input type="text" id="otherPeerTask" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="è«‹è¼¸å…¥å…¶ä»–å·¥ä½œä»»å‹™">
                    </div>
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('peerSelection')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextToPeerRating" class="btn-primary px-6 py-2 rounded-lg font-medium">
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- äº’è©•-è©•åˆ†é é¢ -->
            <div id="peerRating" class="form-page hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="bg-indigo-600 text-white rounded-full w-7 h-7 flex items-center justify-center mr-2">9</span>
                    è«‹ç‚º <span id="currentPeerNameRating" class="text-indigo-600 font-bold"></span> çš„è¡¨ç¾è©•åˆ†ï¼ˆ1-10åˆ†ï¼‰
                </h2>
                <div class="mb-6">
                    <div class="rating-container">
                        <div class="rating-btn" data-value="1" onclick="selectRating(this, 'peerRatingValue')">1</div>
                        <div class="rating-btn" data-value="2" onclick="selectRating(this, 'peerRatingValue')">2</div>
                        <div class="rating-btn" data-value="3" onclick="selectRating(this, 'peerRatingValue')">3</div>
                        <div class="rating-btn" data-value="4" onclick="selectRating(this, 'peerRatingValue')">4</div>
                        <div class="rating-btn" data-value="5" onclick="selectRating(this, 'peerRatingValue')">5</div>
                        <div class="rating-btn" data-value="6" onclick="selectRating(this, 'peerRatingValue')">6</div>
                        <div class="rating-btn" data-value="7" onclick="selectRating(this, 'peerRatingValue')">7</div>
                        <div class="rating-btn" data-value="8" onclick="selectRating(this, 'peerRatingValue')">8</div>
                        <div class="rating-btn" data-value="9" onclick="selectRating(this, 'peerRatingValue')">9</div>
                        <div class="rating-btn" data-value="10" onclick="selectRating(this, 'peerRatingValue')">10</div>
                    </div>
                    <input type="hidden" id="peerRatingValue" value="">
                    <div class="text-center text-sm text-gray-500 mt-2">
                        <span class="float-left">è¼ƒå·®</span>
                        <span class="float-right">å„ªç§€</span>
                    </div>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">æ‚¨çµ¦ä»–/å¥¹é€™å€‹åˆ†æ•¸çš„å…·é«”ç†ç”±</label>
                    <textarea id="peerComment" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="4" placeholder="è«‹è¼¸å…¥æ‚¨çš„è©•åƒ¹ç†ç”±..."></textarea>
                </div>
                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="prevPage('peerTasks')">
                        ä¸Šä¸€æ­¥
                    </button>
                    <button id="nextPeerEval" class="btn-primary px-6 py-2 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ä¸‹ä¸€æ­¥
                    </button>
                </div>
            </div>

            <!-- ç¢ºèªé é¢ -->
            <div id="confirmation" class="form-page hidden">
                <div class="bg-green-50 border-l-4 border-green-400 p-4 mb-6">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-green-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-green-700">
                                æ‚¨å·²å®Œæˆæ‰€æœ‰è©•åƒ¹ï¼æ„Ÿè¬æ‚¨çš„åƒèˆ‡ã€‚
                            </p>
                        </div>
                    </div>
                </div>

                <h2 class="text-xl font-semibold mb-4">è©•åƒ¹æ‘˜è¦</h2>
                
                <div class="mb-6">
                    <h3 class="font-medium text-gray-700 mb-2">åŸºæœ¬è³‡æ–™</h3>
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <p><span class="font-medium">ç­ç´šï¼š</span><span id="summaryClass"></span></p>
                        <p class="mt-1"><span class="font-medium">çµ„åˆ¥ï¼š</span><span id="summaryGroup"></span></p>
                        <p class="mt-1"><span class="font-medium">å§“åï¼š</span><span id="summarySelf"></span></p>
                    </div>
                    
                    <h3 class="font-medium text-gray-700 mb-2">è‡ªè©•</h3>
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <p><span class="font-medium">å·¥ä½œä»»å‹™ï¼š</span><span id="summarySelfTasks"></span></p>
                        <p class="mt-1"><span class="font-medium">å…¶ä»–å·¥ä½œä»»å‹™ï¼š</span><span id="summaryOtherSelfTask"></span></p>
                        <p class="mt-1"><span class="font-medium">æŠ•å…¥ç¨‹åº¦ï¼š</span><span id="summarySelfEffort"></span></p>
                        <p class="mt-1"><span class="font-medium">å…¶ä»–æŠ•å…¥ç¨‹åº¦æè¿°ï¼š</span><span id="summaryOtherSelfEffort"></span></p>
                        <p class="mt-1"><span class="font-medium">è‡ªè©•åˆ†æ•¸ï¼š</span><span id="summarySelfRating"></span></p>
                        <p class="mt-1"><span class="font-medium">è‡ªæˆ‘è©•åƒ¹ï¼š</span></p>
                        <p id="summarySelfComment" class="text-gray-600 mt-1"></p>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="font-medium text-gray-700 mb-2">äº’è©•</h3>
                    <div id="peerEvalSummary" class="space-y-4">
                        <!-- äº’è©•æ‘˜è¦å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>

                <div class="flex justify-between">
                    <button class="btn-secondary px-6 py-2 rounded-lg font-medium" onclick="returnToStart()">
                        è¿”å›ä¿®æ­£
                    </button>
                    <button id="submitForm" class="btn-primary px-6 py-2 rounded-lg font-medium">
                        æäº¤è©•åƒ¹
                    </button>
                </div>
            </div>

            <!-- æäº¤æˆåŠŸé é¢ -->
            <div id="success" class="form-page hidden">
                <div class="text-center py-10">
                    <svg class="mx-auto h-20 w-20 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h2 class="mt-4 text-2xl font-bold text-gray-900">æäº¤æˆåŠŸï¼</h2>
                    <p class="mt-2 text-gray-600">æ„Ÿè¬æ‚¨å®Œæˆè‡ªè©•èˆ‡äº’è©•è¡¨å–®ã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <!-- è¼‰å…¥ä¸­é®ç½© -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p class="text-gray-700 font-medium">æäº¤ä¸­ï¼Œè«‹ç¨å€™...</p>
    </div>

    <script>
    // ç­ç´šå’Œçµ„åˆ¥è³‡æ–™
    const classGroups = {
        '809': [
            { group: 'ç¬¬1çµ„', members: ['04æ—è—¤è«º', '12è¬ç§‰ç¹', '15é‚±é›…æ¶µ', '21é™³å† ç‘œ', '24é»ƒæ˜Ÿç‘œ'] },
            { group: 'ç¬¬2çµ„', members: ['03æ—é§¿æˆ', '09é»ƒçº', '17å¼µéƒå©', '22ç«¥äºèŠ³', '25é»ƒæ¸ç”„'] },
            { group: 'ç¬¬3çµ„', members: ['01ç‹æ³‰è±¡', '12è¬ç§‰ç¹', '08æ›¾å”¯ç¥', '14æ—èŠŠæ¨‚', '19å¼µå­¸æš„'] },
            { group: 'ç¬¬4çµ„', members: ['06å¼µæ©ç‘', '10åŠ‰ä¿®é½Š', '16æ´ªèˆ’èŠ¸', '20é™³æ˜€å½¤', '23é»ƒé‡‡æ½”'] },
            { group: 'ç¬¬5çµ„', members: ['02ææ˜Šå¡', '07æ›¹ç…œæ‰¿', '11åŠ‰ç§©ç¶¸', '18å¼µå®¸èª', '26è¬æ—»çŠ'] }
        ],
        '818': [
            { group: 'ç¬¬1çµ„', members: ['08é™³å¥•å´´', '11è”¡èƒ½ç­Œ', '12è•­å®‰ç¥', '21åŠ‰äºˆè¬™', '27å‘æ–‡æ–‡'] },
            { group: 'ç¬¬2çµ„', members: ['02æå’Œæ¨‚', '03æå“²å»·', '09æ­ç¥ç¶¸', '17æ—å¯æƒŸ', '26ç¾…åŸ¹èŠ¯'] },
            { group: 'ç¬¬3çµ„', members: ['04æ—å“ä½‘', '11è”¡èƒ½ç­Œ', '22è”¡ç’¦å¿»', '23è•­å®‰å¦', '25è—å¿ƒè¨€'] },
            { group: 'ç¬¬4çµ„', members: ['06æ´ªæ™¨è€€', '13è–›ç‰§å®¸', '14é¾ä»•æ°', '15ç‹å©§èŠ¸', '18å­«è‰è‘‰'] },
            { group: 'ç¬¬5çµ„', members: ['01ç‹å®¶è–°', '07å¼µå˜‰å®', '16æä¹‹ç€ ', '20é™³å­å§¸', '24è•­å®‰å¦®'] }
        ]
    };

    // è¡¨å–®è³‡æ–™å„²å­˜
    let formData = {
        class: '', group: '', self: '',
        selfTasks: [], otherSelfTask: '',
        selfEffort: [], otherSelfEffort: '',
        selfRating: '', selfComment: '',
        peerEvals: [], // æ¯å€‹å…ƒç´ æ ¼å¼: { peer: 'å§“å', tasks: [], otherTask: '', rating: '', comment: '' }
        timestamp: ''
    };

    // ç•¶å‰äº’è©•ç›¸é—œ
    let peersToEvaluate = []; // ç•¶å‰é¸æ“‡çµ„åˆ¥å¾Œï¼Œéœ€è¦è©•åƒ¹çš„çµ„å“¡åˆ—è¡¨ (æ’é™¤è‡ªå·±)
    let currentEvaluatingPeerName = ''; // ç•¶å‰æ­£åœ¨è©•åƒ¹çš„çµ„å“¡å§“å
    let formSubmitted = false;

    // é é¢åˆ‡æ›å‡½æ•¸
    function showPage(pageId) {
        document.querySelectorAll('.form-page').forEach(page => {
            page.classList.add('hidden');
        });
        const targetPage = document.getElementById(pageId);
        if (targetPage) {
            targetPage.classList.remove('hidden');
        }
        updateProgressBar(pageId);
    }

    function prevPage(pageId) {
        showPage(pageId);
    }

    function updateProgressBar(pageId) {
        const progressMap = {
            'classSelection': 0, 'groupSelection': 20, 'selfSelection': 20,
            'selfTasks': 40, 'selfEffort': 40, 'selfRating': 40,
            'peerSelection': 60, 'peerTasks': 80, 'peerRating': 80,
            'confirmation': 100, 'success': 100
        };
        let progress = progressMap[pageId] !== undefined ? progressMap[pageId] : 0;

        if (pageId.startsWith('peer') && peersToEvaluate.length > 0) {
            const evaluatedCount = formData.peerEvals.filter(p => p.rating && p.comment).length;
            let currentPeerOrder = formData.peerEvals.findIndex(p => p.peer === currentEvaluatingPeerName);
             if (currentPeerOrder === -1 && formData.peerEvals.length < peersToEvaluate.length) currentPeerOrder = formData.peerEvals.length;
             else if (currentPeerOrder === -1) currentPeerOrder = Math.max(0, peersToEvaluate.length -1) ;


            if (pageId === 'peerSelection') {
                progress = 60 + (evaluatedCount / peersToEvaluate.length) * 20;
            } else if (pageId === 'peerTasks') {
                progress = 60 + (currentPeerOrder / peersToEvaluate.length) * 20 + (1 / peersToEvaluate.length) * 10;
            } else if (pageId === 'peerRating') {
                progress = 60 + (currentPeerOrder / peersToEvaluate.length) * 20 + (1 / peersToEvaluate.length) * 20;
            }
        }
        const progressBarElement = document.getElementById('progressBar');
        if (progressBarElement) {
            progressBarElement.style.width = `${Math.min(progress, 100)}%`;
        }
    }

    // ç­ç´šé¸æ“‡
    function selectClass(element) {
        document.querySelectorAll('#classSelection .option-card').forEach(card => card.classList.remove('selected'));
        element.classList.add('selected');
        formData.class = element.dataset.value;
        document.getElementById('nextToGroup').disabled = false;
        
        const groupOptions = document.getElementById('groupOptions');
        groupOptions.innerHTML = ''; 
        formData.group = ''; 
        document.getElementById('nextToSelfEval').disabled = true;

        if (classGroups[formData.class]) {
            classGroups[formData.class].forEach((groupData) => {
                const groupCard = document.createElement('div');
                groupCard.className = 'option-card p-4 cursor-pointer';
                groupCard.dataset.value = groupData.group;
                groupCard.onclick = function() { selectGroup(this); };
                groupCard.innerHTML = `<div class="flex items-center"><span class="text-indigo-600 text-2xl mr-3">ğŸ‘¥</span><span class="font-medium">${groupData.group}</span></div>`;
                groupOptions.appendChild(groupCard);
            });
        }
    }

    // çµ„åˆ¥é¸æ“‡
    function selectGroup(element) {
        document.querySelectorAll('#groupSelection .option-card').forEach(card => card.classList.remove('selected'));
        element.classList.add('selected');
        formData.group = element.dataset.value;
        document.getElementById('nextToSelfEval').disabled = false;
        
        const memberOptions = document.getElementById('memberOptions');
        memberOptions.innerHTML = ''; 
        formData.self = ''; 
        document.getElementById('nextToSelfTasks').disabled = true;

        const groupData = classGroups[formData.class]?.find(g => g.group === formData.group);
        if (groupData) {
            groupData.members.forEach(member => {
                const memberCard = document.createElement('div');
                memberCard.className = 'option-card p-4 cursor-pointer';
                memberCard.dataset.value = member;
                memberCard.onclick = function() { selectSelf(this); };
                memberCard.innerHTML = `<div class="flex items-center"><span class="text-indigo-600 text-2xl mr-3">ğŸ‘¤</span><span class="font-medium">${member}</span></div>`;
                memberOptions.appendChild(memberCard);
            });
        }
    }

    // é¸æ“‡è‡ªå·±
    function selectSelf(element) {
        document.querySelectorAll('#selfSelection .option-card').forEach(card => card.classList.remove('selected'));
        element.classList.add('selected');
        formData.self = element.dataset.value;
        document.getElementById('nextToSelfTasks').disabled = false;
    }

    // åˆ‡æ›è¤‡é¸æ¡† (é€šç”¨)
    function toggleCheckbox(element, type) { 
        const checkbox = element.querySelector('input[type="checkbox"]');
        if (!checkbox) return;
        checkbox.checked = !checkbox.checked;
        element.classList.toggle('selected', checkbox.checked);
        
        if (type === 'selfTasks') {
            formData.selfTasks = Array.from(document.querySelectorAll('#selfTasks input[type="checkbox"]:checked')).map(cb => cb.value);
            document.getElementById('nextToSelfEffort').disabled = formData.selfTasks.length === 0;
        } else if (type === 'selfEffort') {
            formData.selfEffort = Array.from(document.querySelectorAll('#selfEffort input[type="checkbox"]:checked')).map(cb => cb.value);
            document.getElementById('nextToSelfRating').disabled = formData.selfEffort.length === 0;
        } else if (type === 'peerTasks') {
            const peerEval = formData.peerEvals.find(p => p.peer === currentEvaluatingPeerName);
            if (peerEval) {
                peerEval.tasks = Array.from(document.querySelectorAll('#peerTasks input[type="checkbox"]:checked')).map(cb => cb.value);
            }
            document.getElementById('nextToPeerRating').disabled = false; 
        }
    }
    
    function rebindCheckboxes() {
        document.querySelectorAll('#selfTasks .custom-checkbox').forEach(el => {
            el.onclick = function() { toggleCheckbox(this, 'selfTasks'); };
        });
        document.querySelectorAll('#selfEffort .custom-checkbox').forEach(el => {
            el.onclick = function() { toggleCheckbox(this, 'selfEffort'); };
        });
        document.querySelectorAll('#peerTaskCheckboxes .custom-checkbox').forEach(el => {
            el.onclick = function() { toggleCheckbox(this, 'peerTasks'); };
        });
    }
    
    // é¸æ“‡è©•åˆ†
function selectRating(element, inputIdPrefix) {
    console.log('[selectRating] Called. inputIdPrefix:', inputIdPrefix, 'Element value:', element.dataset.value); // æ–°å¢æ—¥èªŒ
    const container = element.closest('.rating-container');
    if (!container) {
        console.error('[selectRating] Rating container not found.'); // æ–°å¢æ—¥èªŒ
        return;
    }
    container.querySelectorAll('.rating-btn').forEach(btn => btn.classList.remove('selected'));
    element.classList.add('selected');
    const ratingValue = element.dataset.value;
    const ratingValueInput = document.getElementById(inputIdPrefix); // é€™æ‡‰è©²æ˜¯ 'selfRatingValue' æˆ– 'peerRatingValue'

    if (ratingValueInput) {
        ratingValueInput.value = ratingValue;
    } else {
        console.error('[selectRating] Hidden input not found for ID:', inputIdPrefix); // æ–°å¢æ—¥èªŒ
    }

    if (inputIdPrefix === 'selfRatingValue') { // ç¢ºä¿é€™è£¡çš„ ID èˆ‡ HTML onclick å‚³å…¥çš„ä¸€è‡´
        formData.selfRating = ratingValue;
        console.log('[selectRating] formData.selfRating set to:', formData.selfRating); // æ–°å¢æ—¥èªŒ
        console.log('[selectRating] Calling checkSelfRatingComplete...'); // æ–°å¢æ—¥èªŒ
        checkSelfRatingComplete();
    } else if (inputIdPrefix === 'peerRatingValue') {
        const peerEval = formData.peerEvals.find(p => p.peer === currentEvaluatingPeerName);
        if (peerEval) {
            peerEval.rating = ratingValue;
            console.log('[selectRating] Peer rating set for', currentEvaluatingPeerName, 'to:', peerEval.rating); // æ–°å¢æ—¥èªŒ
        }
        console.log('[selectRating] Calling checkPeerRatingComplete for peer...'); // æ–°å¢æ—¥èªŒ
        checkPeerRatingComplete();
    }
}

    // æª¢æŸ¥è‡ªè©•è©•åˆ†æ˜¯å¦å®Œæˆ
function checkSelfRatingComplete() {
    console.log('[checkSelfRatingComplete] Called.'); // æ–°å¢æ—¥èªŒ
    const selfCommentElement = document.getElementById('selfComment');
    if (selfCommentElement) {
        formData.selfComment = selfCommentElement.value.trim();
    } else {
        console.error('[checkSelfRatingComplete] selfComment textarea not found.'); // æ–°å¢æ—¥èªŒ
        formData.selfComment = ''; // é¿å…å¾ŒçºŒå‡ºéŒ¯
    }

    console.log('[checkSelfRatingComplete] formData.selfRating:', formData.selfRating); // æ–°å¢æ—¥èªŒ
    console.log('[checkSelfRatingComplete] formData.selfComment:', formData.selfComment); // æ–°å¢æ—¥èªŒ

    const nextButton = document.getElementById('nextToPeerEval');
    if (nextButton) {
        constisDisabled = !(formData.selfRating && formData.selfComment);
        nextButton.disabled = isDisabled;
        console.log('[checkSelfRatingComplete] Condition (formData.selfRating && formData.selfComment):', (formData.selfRating && formData.selfComment)); // æ–°å¢æ—¥èªŒ
        console.log('[checkSelfRatingComplete] nextToPeerEval button disabled set to:', isDisabled); // æ–°å¢æ—¥èªŒ
    } else {
        console.error('[checkSelfRatingComplete] nextToPeerEval button not found.'); // æ–°å¢æ—¥èªŒ
    }
}

    // æª¢æŸ¥äº’è©•è©•åˆ†æ˜¯å¦å®Œæˆ
    function checkPeerRatingComplete() {
        const peerEval = formData.peerEvals.find(p => p.peer === currentEvaluatingPeerName);
        if (peerEval) {
            peerEval.comment = document.getElementById('peerComment').value.trim();
            document.getElementById('nextPeerEval').disabled = !(peerEval.rating && peerEval.comment);
        } else {
            document.getElementById('nextPeerEval').disabled = true;
        }
    }

    // åˆå§‹åŒ–äº’è©•ç›¸é—œè®Šæ•¸
    function initializePeerEvaluation() {
        const groupData = classGroups[formData.class]?.find(g => g.group === formData.group);
        if (!groupData) return;
        peersToEvaluate = groupData.members.filter(member => member !== formData.self);
        formData.peerEvals = []; 
        updatePeerOptionsDisplay(); 
        updatePeerEvalCountDisplay();
    }
    
    function updatePeerOptionsDisplay() {
        const peerOptionsContainer = document.getElementById('peerOptions');
        if(!peerOptionsContainer) return;
        peerOptionsContainer.innerHTML = ''; 

        peersToEvaluate.forEach(peerName => {
            const peerEvalData = formData.peerEvals.find(p => p.peer === peerName);
            const isEvaluated = peerEvalData && peerEvalData.rating && peerEvalData.comment;

            const peerCard = document.createElement('div');
            peerCard.className = `option-card p-4 cursor-pointer ${isEvaluated ? 'evaluated' : ''} ${currentEvaluatingPeerName === peerName && !isEvaluated ? 'selected' : ''}`;
            peerCard.dataset.value = peerName;
            peerCard.onclick = function() { selectPeerToEvaluate(this); };
            
            let statusText = isEvaluated ? '<span class="text-green-500 text-sm ml-2">ï¼ˆå·²è©•å®Œï¼‰</span>' : '';
            
            peerCard.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                       <span class="text-indigo-600 text-2xl mr-3">ğŸ‘¤</span>
                       <span class="font-medium">${peerName}</span>
                    </div>
                    ${statusText}
                </div>`;
            peerOptionsContainer.appendChild(peerCard);
        });

        const nextButton = document.getElementById('nextToPeerTasks');
        if (!nextButton) return;

        const allPeersEvaluated = formData.peerEvals.length === peersToEvaluate.length && peersToEvaluate.length > 0 && formData.peerEvals.every(p => p.rating && p.comment);
        if (allPeersEvaluated) {
            nextButton.textContent = "å®Œæˆäº’è©•ï¼ŒæŸ¥çœ‹æ‘˜è¦"; 
            nextButton.disabled = false; 
            nextButton.onclick = function() { 
                prepareSummary();
                showPage('confirmation');
            };
        } else if (currentEvaluatingPeerName) {
            const currentPeerData = formData.peerEvals.find(p => p.peer === currentEvaluatingPeerName);
            nextButton.textContent = (currentPeerData && currentPeerData.rating && currentPeerData.comment) ? "æŸ¥çœ‹/ä¿®æ”¹æ­¤çµ„å“¡è©•åƒ¹" : "é–‹å§‹è©•åƒ¹æ­¤çµ„å“¡";
            nextButton.disabled = false;
            nextButton.onclick = function() { loadPeerTasksPageFor(currentEvaluatingPeerName); };
        } else {
            nextButton.textContent = "é¸æ“‡çµ„å“¡å¾Œé€²è¡Œä¸‹ä¸€æ­¥";
            nextButton.disabled = true; 
            nextButton.onclick = function() { if(currentEvaluatingPeerName) loadPeerTasksPageFor(currentEvaluatingPeerName); };
        }
    }

    function selectPeerToEvaluate(element) {
        currentEvaluatingPeerName = element.dataset.value; 
        updatePeerOptionsDisplay(); // Just re-run to update selection and button state
    }
    
    function loadPeerTasksPageFor(peerName) {
        if (!peerName) return;
        currentEvaluatingPeerName = peerName; 
        const currentPeerNameSpan = document.getElementById('currentPeerName');
        const currentPeerNameRatingSpan = document.getElementById('currentPeerNameRating');
        if (currentPeerNameSpan) currentPeerNameSpan.textContent = peerName;
        if (currentPeerNameRatingSpan) currentPeerNameRatingSpan.textContent = peerName;

        let peerEval = formData.peerEvals.find(p => p.peer === peerName);
        if (!peerEval) {
            peerEval = { peer: peerName, tasks: [], otherTask: '', rating: '', comment: '' };
            formData.peerEvals.push(peerEval);
        }
        resetAndFillPeerForm(peerEval);
        showPage('peerTasks');
    }

    function resetAndFillPeerForm(peerEvalData) {
        document.querySelectorAll('#peerTaskCheckboxes input[type="checkbox"]').forEach(cb => {
            cb.checked = false;
            cb.closest('.custom-checkbox')?.classList.remove('selected');
        });
        const otherPeerTaskInput = document.getElementById('otherPeerTask');
        if (otherPeerTaskInput) otherPeerTaskInput.value = '';
        
        document.querySelectorAll('#peerRating .rating-btn').forEach(btn => btn.classList.remove('selected'));
        const peerRatingValueInput = document.getElementById('peerRatingValue');
        if (peerRatingValueInput) peerRatingValueInput.value = '';
        const peerCommentTextarea = document.getElementById('peerComment');
        if (peerCommentTextarea) peerCommentTextarea.value = '';
        const nextPeerEvalButton = document.getElementById('nextPeerEval');
        if (nextPeerEvalButton) nextPeerEvalButton.disabled = true; 

        if (peerEvalData) {
            if (peerEvalData.tasks && peerEvalData.tasks.length > 0) {
                document.querySelectorAll('#peerTaskCheckboxes input[type="checkbox"]').forEach(cb => {
                    if (peerEvalData.tasks.includes(cb.value)) {
                        cb.checked = true;
                        cb.closest('.custom-checkbox')?.classList.add('selected');
                    }
                });
            }
            if (otherPeerTaskInput) otherPeerTaskInput.value = peerEvalData.otherTask || '';
            if (peerEvalData.rating) {
                document.querySelector(`#peerRating .rating-btn[data-value="${peerEvalData.rating}"]`)?.classList.add('selected');
                if (peerRatingValueInput) peerRatingValueInput.value = peerEvalData.rating;
            }
            if (peerCommentTextarea) peerCommentTextarea.value = peerEvalData.comment || '';
            checkPeerRatingComplete(); 
        }
        const nextToPeerRatingButton = document.getElementById('nextToPeerRating');
        if (nextToPeerRatingButton) nextToPeerRatingButton.disabled = false;
        rebindCheckboxes(); // Rebind after potential DOM changes for peer tasks
    }
    
    function updatePeerEvalCountDisplay() {
        const peerEvalCountSpan = document.getElementById('peerEvalCount');
        if (!peerEvalCountSpan) return;
        const evaluatedCount = formData.peerEvals.filter(p => p.rating && p.comment).length;
        const totalPeersToEvaluate = peersToEvaluate.length;
        peerEvalCountSpan.textContent = `${evaluatedCount}/${totalPeersToEvaluate}`;
    }

    function handleNextPeerOrConfirmation() {
        updatePeerEvalCountDisplay(); 
        updatePeerOptionsDisplay(); 

        const allPeersEvaluated = formData.peerEvals.length === peersToEvaluate.length && peersToEvaluate.length > 0 && formData.peerEvals.every(p => p.rating && p.comment);

        if (allPeersEvaluated) {
            prepareSummary();
            showPage('confirmation');
        } else {
            let nextPeerToEvaluate = peersToEvaluate.find(pName => !formData.peerEvals.find(ev => ev.peer === pName && ev.rating && ev.comment));
            currentEvaluatingPeerName = nextPeerToEvaluate || ''; // Go to selection if no specific next one or clear
            showPage('peerSelection'); 
        }
    }

    // æº–å‚™æ‘˜è¦é é¢
    function prepareSummary() {
        document.getElementById('summaryClass').textContent = formData.class + 'ç­';
        document.getElementById('summaryGroup').textContent = formData.group;
        document.getElementById('summarySelf').textContent = formData.self;
        document.getElementById('summarySelfTasks').textContent = formData.selfTasks.join(', ') || 'ç„¡';
        document.getElementById('summaryOtherSelfTask').textContent = formData.otherSelfTask || 'ç„¡';
        document.getElementById('summarySelfEffort').textContent = formData.selfEffort.join(', ') || 'ç„¡';
        document.getElementById('summaryOtherSelfEffort').textContent = formData.otherSelfEffort || 'ç„¡';
        document.getElementById('summarySelfRating').textContent = formData.selfRating;
        document.getElementById('summarySelfComment').textContent = formData.selfComment;
        
        const peerEvalSummaryContainer = document.getElementById('peerEvalSummary');
        peerEvalSummaryContainer.innerHTML = '';
        
        formData.peerEvals.forEach((peerEval) => {
            if (peerEval.peer && peerEval.rating && peerEval.comment) {
                const peerSummary = document.createElement('div');
                peerSummary.className = 'bg-gray-50 p-4 rounded-lg mb-4';
                const peerIndexForDisplay = peersToEvaluate.indexOf(peerEval.peer) + 1;
                peerSummary.innerHTML = `
                    <h4 class="font-medium text-indigo-600 mb-2">äº’è©• ${peerIndexForDisplay > 0 ? peerIndexForDisplay : 'ç‰¹å®š'} : ${peerEval.peer}</h4>
                    <p><span class="font-medium">è§€å¯Ÿåˆ°çš„å·¥ä½œä»»å‹™ï¼š</span>${peerEval.tasks ? peerEval.tasks.join(', ') : 'æœªè¨˜éŒ„'}</p>
                    <p class="mt-1"><span class="font-medium">å…¶ä»–è§€å¯Ÿåˆ°çš„å·¥ä½œä»»å‹™ï¼š</span>${peerEval.otherTask || 'ç„¡'}</p>
                    <p class="mt-1"><span class="font-medium">è©•åˆ†ï¼š</span>${peerEval.rating}</p>
                    <p class="mt-1"><span class="font-medium">è©•åƒ¹ç†ç”±ï¼š</span></p>
                    <p class="text-gray-600 mt-1">${peerEval.comment}</p>`;
                peerEvalSummaryContainer.appendChild(peerSummary);
            }
        });
    }

    // è¿”å›é–‹å§‹é é¢ (é‡ç½®è¡¨å–®)
    function returnToStart() {
        formData = {
            class: '', group: '', self: '', selfTasks: [], otherSelfTask: '',
            selfEffort: [], otherSelfEffort: '', selfRating: '', selfComment: '',
            peerEvals: [], timestamp: ''
        };
        peersToEvaluate = []; currentEvaluatingPeerName = ''; formSubmitted = false;

        document.querySelectorAll('input[type="text"], textarea').forEach(input => input.value = '');
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
            cb.checked = false;
            cb.closest('.custom-checkbox')?.classList.remove('selected');
        });
        document.querySelectorAll('.option-card.selected').forEach(card => card.classList.remove('selected'));
        document.querySelectorAll('.rating-btn.selected').forEach(btn => btn.classList.remove('selected'));
        
        ['nextToGroup', 'nextToSelfEval', 'nextToSelfTasks', 'nextToSelfEffort', 
         'nextToSelfRating', 'nextToPeerEval', 'nextToPeerTasks', 'nextPeerEval']
        .forEach(id => {
            const button = document.getElementById(id);
            if (button) button.disabled = true;
        });
        showPage('classSelection');
    }

    // æäº¤è¡¨å–®åˆ°Googleè©¦ç®—è¡¨
    async function submitToGoogleSheet() {
        if (formSubmitted) {
            alert('è¡¨å–®å·²æäº¤ï¼Œè«‹å‹¿é‡è¤‡æäº¤ã€‚');
            return;
        }
        const loadingOverlay = document.getElementById('loadingOverlay');
        if (loadingOverlay) loadingOverlay.classList.remove('hidden');
        
        formData.timestamp = new Date().toISOString();
        
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxY158J77F4HeduN_lHKyTllJU9ySIAWU_cBscsumrOe52fC7pEno9_KghPesqjhGM8/exec'; // !!! è«‹å‹™å¿…æ›¿æ›æˆæ‚¨è‡ªå·±çš„ !!!

        if (scriptURL === 'https://script.google.com/macros/s/AKfycbxY158J77F4HeduN_lHKyTllJU9ySIAWU_cBscsumrOe52fC7pEno9_KghPesqjhGM8/exec' || scriptURL.includes('AKfycbxY158J77F4HeduN_lHKyTllJU9ySIAWU_cBscsumrOe52fC7pEno9_KghPesqjhGM8') && scriptURL !== 'YOUR_REAL_URL_IF_TESTING') {
             if (loadingOverlay) loadingOverlay.classList.add('hidden');
             alert('éŒ¯èª¤ï¼šè«‹å…ˆåœ¨HTMLç¨‹å¼ç¢¼ä¸­è¨­å®šæ‚¨è‡ªå·±çš„Google Apps Script Web App URL (scriptURLè®Šæ•¸)ã€‚');
             return;
        }

        try {
            const formattedData = formatDataForSubmission(formData);
            const response = await fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors', 
                headers: {
                     // 'Content-Type': 'application/json' // For 'no-cors', this header might be ignored or cause issues.
                                                            // Apps Script doPost by default can handle application/x-www-form-urlencoded if 'e.parameter' is used.
                                                            // For 'e.postData.contents' to work with JSON, the server (Apps Script) needs to handle it,
                                                            // and 'no-cors' can make this tricky.
                                                            // Let's try without explicitly setting Content-Type for 'no-cors' first if JSON parsing fails.
                                                            // Or, keep it and hope GAS is lenient with no-cors + application/json
                    'Content-Type': 'application/json', // Keeping for now based on previous attempts
                },
                body: JSON.stringify(formattedData), // <-- ä¿®æ­£ï¼šè£œå› body
            });
            
            // With 'no-cors', response.ok will be false, response.status will be 0.
            // We can't reliably check for success from the response here.
            // Assume success if no error is thrown by fetch itself, and check Google Sheet.
            if (loadingOverlay) loadingOverlay.classList.add('hidden');
            formSubmitted = true; // Optimistically set to true
            showPage('success');
            // alert('è©•åƒ¹å·²å˜—è©¦æäº¤ï¼è«‹æª¢æŸ¥æ‚¨çš„ Google è©¦ç®—è¡¨ç¢ºèªè³‡æ–™æ˜¯å¦å·²å¯«å…¥ã€‚ç”±æ–¼ç€è¦½å™¨é™åˆ¶ï¼Œç„¡æ³•ç›´æ¥ç¢ºèªæäº¤ç‹€æ…‹ã€‚');

        } catch (error) {
            console.error('æäº¤éŒ¯èª¤:', error);
            if (loadingOverlay) loadingOverlay.classList.add('hidden');
            alert(`æäº¤å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚\néŒ¯èª¤è©³æƒ…ï¼š${error.message}`);
        }
    }

    // æ ¼å¼åŒ–è³‡æ–™ä»¥ä¾¿æäº¤
    function formatDataForSubmission(data) {
        const baseData = {
            timestamp: data.timestamp, class: data.class, group: data.group, self: data.self,
            selfTasks: data.selfTasks.join(', '), otherSelfTask: data.otherSelfTask,
            selfEffort: data.selfEffort.join(', '), otherSelfEffort: data.otherSelfEffort,
            selfRating: data.selfRating, selfComment: data.selfComment
        };
        peersToEvaluate.forEach((peerNameToEval, index) => {
            const evalData = data.peerEvals.find(p => p.peer === peerNameToEval);
            const i = index + 1; 
            if (evalData) {
                baseData[`peer${i}`] = evalData.peer;
                baseData[`peer${i}Tasks`] = evalData.tasks ? evalData.tasks.join(', ') : '';
                baseData[`peer${i}OtherTask`] = evalData.otherTask || '';
                baseData[`peer${i}Rating`] = evalData.rating;
                baseData[`peer${i}Comment`] = evalData.comment;
            } else {
                baseData[`peer${i}`] = peerNameToEval; 
                baseData[`peer${i}Tasks`] = ''; baseData[`peer${i}OtherTask`] = '';
                baseData[`peer${i}Rating`] = ''; baseData[`peer${i}Comment`] = '';
            }
        });
        return baseData;
    }

    // æˆªåœ–åŠŸèƒ½ (æ‚¨çš„åŸå§‹ç¢¼ä¸­æ²’æœ‰ï¼Œä½†ä¹‹å‰è¨è«–éï¼Œå¦‚æœéœ€è¦å¯ä»¥å¾ä¹‹å‰çš„ç‰ˆæœ¬è¤‡è£½éä¾†)
    // async function takeScreenshot() { ... }


    // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        rebindCheckboxes(); // Bind all checkbox handlers initially
        showPage('classSelection'); // Initial page

        const selfCommentTextarea = document.getElementById('selfComment');
if (selfCommentTextarea) {
    selfCommentTextarea.addEventListener('input', function() { // å°‡ checkSelfRatingComplete ç›´æ¥åŒ…è£ä»¥å¢åŠ æ—¥èªŒ
        console.log('[selfComment input event] Input detected, calling checkSelfRatingComplete...'); // æ–°å¢æ—¥èªŒ
        checkSelfRatingComplete();
    });
} else {
    console.error('[DOMContentLoaded] selfComment textarea not found for event listener setup.'); // æ–°å¢æ—¥èªŒ
}

        document.getElementById('nextToGroup').addEventListener('click', function() { if (formData.class) showPage('groupSelection'); });
        document.getElementById('nextToSelfEval').addEventListener('click', function() { if (formData.group) showPage('selfSelection'); });
        document.getElementById('nextToSelfTasks').addEventListener('click', function() { 
            if (formData.self) {
                ['selfTasks', 'selfEffort'].forEach(type => {
                    document.querySelectorAll(`#${type} input[type="checkbox"]`).forEach(cb => {
                        cb.checked = false;
                        cb.closest('.custom-checkbox')?.classList.remove('selected');
                    });
                    formData[type] = [];
                });
                document.getElementById('otherSelfTask').value = '';
                document.getElementById('otherSelfEffort').value = '';
                document.getElementById('nextToSelfEffort').disabled = true;
                document.getElementById('nextToSelfRating').disabled = true;
                showPage('selfTasks');
            }
        });
        document.getElementById('nextToSelfEffort').addEventListener('click', function() {
            formData.otherSelfTask = document.getElementById('otherSelfTask').value.trim();
            if (formData.selfTasks.length > 0) showPage('selfEffort');
            else alert('è«‹è‡³å°‘é¸æ“‡ä¸€é …æ‚¨è² è²¬çš„å·¥ä½œä»»å‹™ã€‚');
        });
        document.getElementById('nextToSelfRating').addEventListener('click', function() {
            formData.otherSelfEffort = document.getElementById('otherSelfEffort').value.trim();
            if (formData.selfEffort.length > 0) {
                document.querySelectorAll('#selfRating .rating-btn.selected').forEach(btn => btn.classList.remove('selected'));
                document.getElementById('selfRatingValue').value = ''; formData.selfRating = '';
                document.getElementById('selfComment').value = ''; formData.selfComment = '';
                document.getElementById('nextToPeerEval').disabled = true;
                showPage('selfRating');
            } else alert('è«‹è‡³å°‘é¸æ“‡ä¸€é …æè¿°æ‚¨çš„æŠ•å…¥ç¨‹åº¦ã€‚');
        });
        document.getElementById('selfComment').addEventListener('input', checkSelfRatingComplete);
        document.getElementById('nextToPeerEval').addEventListener('click', function() {
            if (formData.selfRating && formData.selfComment) {
                initializePeerEvaluation(); 
                showPage('peerSelection');
            } else alert('è«‹å®Œæˆè‡ªè©•åˆ†æ•¸å’Œè‡ªæˆ‘è©•åƒ¹ã€‚');
        });
        document.getElementById('nextToPeerTasks').addEventListener('click', function() {
            const allPeersEvaluated = formData.peerEvals.length === peersToEvaluate.length && peersToEvaluate.length > 0 && formData.peerEvals.every(p => p.rating && p.comment);
            if (currentEvaluatingPeerName && !allPeersEvaluated) { 
                loadPeerTasksPageFor(currentEvaluatingPeerName);
            } else if (allPeersEvaluated) {
                prepareSummary();
                showPage('confirmation');
            } else {
                alert('è«‹å…ˆé¸æ“‡ä¸€ä½æ‚¨è¦è©•åƒ¹çš„çµ„å“¡ã€‚');
            }
        });
        document.getElementById('nextToPeerRating').addEventListener('click', function() {
            const peerEval = formData.peerEvals.find(p => p.peer === currentEvaluatingPeerName);
            if (peerEval) peerEval.otherTask = document.getElementById('otherPeerTask').value.trim();
            if(peerEval && !peerEval.rating) { 
                document.querySelectorAll('#peerRating .rating-btn.selected').forEach(btn => btn.classList.remove('selected'));
                document.getElementById('peerRatingValue').value = '';
            }
            if(peerEval && !peerEval.comment) document.getElementById('peerComment').value = '';
            document.getElementById('nextPeerEval').disabled = !(peerEval && peerEval.rating && peerEval.comment);
            showPage('peerRating');
        });
        document.getElementById('peerComment').addEventListener('input', checkPeerRatingComplete);
        document.getElementById('nextPeerEval').addEventListener('click', function() {
            const peerEval = formData.peerEvals.find(p => p.peer === currentEvaluatingPeerName);
            if (peerEval && peerEval.rating && peerEval.comment) handleNextPeerOrConfirmation();
            else alert('è«‹ç‚ºé€™ä½çµ„å“¡é¸æ“‡è©•åˆ†ä¸¦å¡«å¯«è©•åƒ¹ç†ç”±ã€‚');
        });
        document.getElementById('submitForm').addEventListener('click', function() { submitToGoogleSheet(); });
        
        // å¦‚æœæ‚¨çš„ HTML è£¡æœ‰ takeScreenshot æŒ‰éˆ•ï¼Œè¨˜å¾—åŠ ä¸Šç›£è½å™¨
        // const takeScreenshotButton = document.getElementById('takeScreenshot');
        // if (takeScreenshotButton) {
        //     takeScreenshotButton.addEventListener('click', takeScreenshot);
        // }
    });
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'945cc1cbe27c8448',t:'MTc0ODI1NzEwMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
